<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë®ò‰∫ãÁÆ°ÁêÜ | Dive Buddy'sÁÆ°ÁêÜÁîªÈù¢</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: #f8fafc;
            color: #374151;
            line-height: 1.6;
        }

        .admin-header {
            background: #1f2937;
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .admin-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-logo {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .admin-links {
            display: flex;
            gap: 1rem;
        }

        .admin-links a {
            color: #9ca3af;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .admin-links a:hover, .admin-links a.active {
            background: #374151;
            color: white;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1f2937;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-danger {
            background: #dc2626;
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }

        .filters-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #374151;
            font-size: 0.9rem;
        }

        .filter-input, .filter-select {
            padding: 0.6rem;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .filter-input:focus, .filter-select:focus {
            outline: none;
            border-color: #2563eb;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #2563eb;
            display: block;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .articles-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .table-header {
            background: #f8fafc;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-weight: 600;
            color: #374151;
        }

        .table-actions {
            display: flex;
            gap: 0.5rem;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 1rem 1.5rem;
            text-align: left;
            border-bottom: 1px solid #f3f4f6;
        }

        .table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
        }

        .table tr:hover {
            background: #f9fafb;
        }

        .article-title {
            font-weight: 600;
            color: #1f2937;
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .article-excerpt {
            color: #6b7280;
            font-size: 0.9rem;
            max-width: 250px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-published {
            background: #d1fae5;
            color: #065f46;
        }

        .status-draft {
            background: #fef3c7;
            color: #92400e;
        }

        .status-scheduled {
            background: #dbeafe;
            color: #1e40af;
        }

        .category-badge {
            background: #e0e7ff;
            color: #3730a3;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            padding: 0.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-size: 0.8rem;
        }

        .btn-edit {
            background: #059669;
        }

        .btn-edit:hover {
            background: #047857;
        }

        .btn-delete {
            background: #dc2626;
        }

        .btn-delete:hover {
            background: #b91c1c;
        }

        .btn-view {
            background: #2563eb;
        }

        .btn-view:hover {
            background: #1d4ed8;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            padding: 1.5rem;
            background: white;
            border-top: 1px solid #e5e7eb;
        }

        .pagination button {
            padding: 0.5rem 1rem;
            border: 1px solid #e5e7eb;
            background: white;
            color: #374151;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination button:hover:not(:disabled) {
            background: #f3f4f6;
        }

        .pagination button.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #6b7280;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
        }

        .modal-header {
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1f2937;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        @media (max-width: 1024px) {
            .container {
                padding: 1rem;
            }
            
            .page-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .filters-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .table-responsive {
                overflow-x: auto;
            }
            
            .table th,
            .table td {
                padding: 0.75rem;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 640px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ÁÆ°ÁêÜÁîªÈù¢„Éò„ÉÉ„ÉÄ„Éº -->
    <header class="admin-header">
        <nav class="admin-nav">
            <div class="admin-logo">
                üåä Dive Buddy's ÁÆ°ÁêÜÁîªÈù¢
            </div>
            <div class="admin-links">
                <a href="/admin/dashboard.html">„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</a>
                <a href="/admin/blog-editor.html">Ë®ò‰∫ã‰ΩúÊàê</a>
                <a href="/admin/blog-list.html" class="active">Ë®ò‰∫ãÁÆ°ÁêÜ</a>
                <a href="/admin/analytics.html">ÂàÜÊûê</a>
                <a href="/">„Çµ„Ç§„Éà„Å∏Êàª„Çã</a>
            </div>
        </nav>
    </header>

    <div class="container">
        <!-- „Éö„Éº„Ç∏„Éò„ÉÉ„ÉÄ„Éº -->
        <div class="page-header">
            <h1 class="page-title">üìù Ë®ò‰∫ãÁÆ°ÁêÜ</h1>
            <div class="header-actions">
                <button class="btn btn-secondary btn-small" onclick="refreshData()">
                    <i class="fas fa-sync-alt"></i> Êõ¥Êñ∞
                </button>
                <a href="/admin/blog-editor.html" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Êñ∞Ë¶èË®ò‰∫ã‰ΩúÊàê
                </a>
            </div>
        </div>

        <!-- Áµ±Ë®à„Ç´„Éº„Éâ -->
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-number" id="total-articles">-</span>
                <div class="stat-label">Á∑èË®ò‰∫ãÊï∞</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="published-articles">-</span>
                <div class="stat-label">ÂÖ¨ÈñãÊ∏à„Åø</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="draft-articles">-</span>
                <div class="stat-label">‰∏ãÊõ∏„Åç</div>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="total-views">-</span>
                <div class="stat-label">Á∑èÈñ≤Ë¶ßÊï∞</div>
            </div>
        </div>

        <!-- „Éï„Ç£„É´„Çø„Éº -->
        <div class="filters-section">
            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label">Ê§úÁ¥¢</label>
                    <input type="text" class="filter-input" id="search-input" placeholder="„Çø„Ç§„Éà„É´„ÉªÂÜÖÂÆπ„ÅßÊ§úÁ¥¢">
                </div>
                <div class="filter-group">
                    <label class="filter-label">„Ç´„ÉÜ„Ç¥„É™</label>
                    <select class="filter-select" id="category-filter">
                        <option value="">„Åô„Åπ„Å¶„ÅÆ„Ç´„ÉÜ„Ç¥„É™</option>
                        <option value="diving_spots">„ÉÄ„Ç§„Éì„É≥„Ç∞„Çπ„Éù„ÉÉ„Éà</option>
                        <option value="marine_life">Êµ∑Ê¥ãÁîüÁâ©</option>
                        <option value="travel_tips">ÊóÖË°åTips</option>
                        <option value="equipment">Âô®Êùê„ÉªË£ÖÂÇô</option>
                        <option value="beginner_guide">ÂàùÂøÉËÄÖ„Ç¨„Ç§„Éâ</option>
                        <option value="seasonal_info">Â≠£ÁØÄÊÉÖÂ†±</option>
                        <option value="shop_review">„Ç∑„Éß„ÉÉ„ÉóÊÉÖÂ†±</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">„Çπ„ÉÜ„Éº„Çø„Çπ</label>
                    <select class="filter-select" id="status-filter">
                        <option value="">„Åô„Åπ„Å¶„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ</option>
                        <option value="published">ÂÖ¨ÈñãÊ∏à„Åø</option>
                        <option value="draft">‰∏ãÊõ∏„Åç</option>
                        <option value="scheduled">ÂÖ¨Èñã‰∫àÁ¥Ñ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">‰∏¶„Å≥È†Ü</label>
                    <select class="filter-select" id="sort-select">
                        <option value="updated_at-desc">Êõ¥Êñ∞Êó•ÊôÇÔºàÊñ∞„Åó„ÅÑÈ†ÜÔºâ</option>
                        <option value="updated_at-asc">Êõ¥Êñ∞Êó•ÊôÇÔºàÂè§„ÅÑÈ†ÜÔºâ</option>
                        <option value="published_at-desc">ÂÖ¨ÈñãÊó•ÊôÇÔºàÊñ∞„Åó„ÅÑÈ†ÜÔºâ</option>
                        <option value="published_at-asc">ÂÖ¨ÈñãÊó•ÊôÇÔºàÂè§„ÅÑÈ†ÜÔºâ</option>
                        <option value="title-asc">„Çø„Ç§„Éà„É´Ôºà„ÅÇ„ÅÑ„ÅÜ„Åà„ÅäÈ†ÜÔºâ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">&nbsp;</label>
                    <button class="btn btn-primary btn-small" onclick="applyFilters()">
                        <i class="fas fa-search"></i> Ê§úÁ¥¢
                    </button>
                </div>
            </div>
        </div>

        <!-- Ë®ò‰∫ã„ÉÜ„Éº„Éñ„É´ -->
        <div class="articles-table">
            <div class="table-header">
                <div class="table-title">Ë®ò‰∫ã‰∏ÄË¶ß</div>
                <div class="table-actions">
                    <select class="filter-select" id="bulk-action" style="margin-right: 0.5rem;">
                        <option value="">‰∏ÄÊã¨Êìç‰Ωú</option>
                        <option value="publish">ÂÖ¨Èñã</option>
                        <option value="draft">‰∏ãÊõ∏„Åç„Å´Êàª„Åô</option>
                        <option value="delete">ÂâäÈô§</option>
                    </select>
                    <button class="btn btn-secondary btn-small" onclick="executeBulkAction()">
                        ÂÆüË°å
                    </button>
                </div>
            </div>
            
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th width="40">
                                <input type="checkbox" id="select-all" onchange="toggleSelectAll()">
                            </th>
                            <th width="300">„Çø„Ç§„Éà„É´</th>
                            <th width="250">ÊäúÁ≤ã</th>
                            <th width="120">„Ç´„ÉÜ„Ç¥„É™</th>
                            <th width="100">„Çπ„ÉÜ„Éº„Çø„Çπ</th>
                            <th width="100">‰ΩúÊàêËÄÖ</th>
                            <th width="120">Êõ¥Êñ∞Êó•ÊôÇ</th>
                            <th width="120">Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody id="articles-tbody">
                        <!-- Ë®ò‰∫ã„Éá„Éº„Çø„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
                    </tbody>
                </table>
            </div>

            <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ -->
            <div class="pagination" id="pagination">
                <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
            </div>
        </div>
    </div>

    <!-- ÂâäÈô§Á¢∫Ë™ç„É¢„Éº„ÉÄ„É´ -->
    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Ë®ò‰∫ãÂâäÈô§„ÅÆÁ¢∫Ë™ç</h3>
            </div>
            <p>„Åì„ÅÆË®ò‰∫ã„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü</p>
            <p><strong id="delete-article-title"></strong></p>
            <p style="color: #dc2626; font-size: 0.9rem; margin-top: 1rem;">
                ‚Äª „Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åô„Åì„Å®„Åå„Åß„Åç„Åæ„Åõ„Çì„ÄÇ
            </p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeDeleteModal()">„Ç≠„É£„É≥„Çª„É´</button>
                <button class="btn btn-danger" onclick="confirmDelete()">ÂâäÈô§„Åô„Çã</button>
            </div>
        </div>
    </div>

    <script>
        // ÁÆ°ÁêÜ„Éá„Éº„Çø
        let currentPage = 1;
        let itemsPerPage = 10;
        let totalItems = 0;
        let allArticles = [];
        let filteredArticles = [];
        let deleteArticleId = null;
        let selectedArticles = new Set();

        // „Ç´„ÉÜ„Ç¥„É™„Éû„ÉÉ„Éî„É≥„Ç∞
        const categoryNames = {
            'diving_spots': '„ÉÄ„Ç§„Éì„É≥„Ç∞„Çπ„Éù„ÉÉ„Éà',
            'marine_life': 'Êµ∑Ê¥ãÁîüÁâ©',
            'travel_tips': 'ÊóÖË°åTips',
            'equipment': 'Âô®Êùê„ÉªË£ÖÂÇô',
            'beginner_guide': 'ÂàùÂøÉËÄÖ„Ç¨„Ç§„Éâ',
            'seasonal_info': 'Â≠£ÁØÄÊÉÖÂ†±',
            'shop_review': '„Ç∑„Éß„ÉÉ„ÉóÊÉÖÂ†±'
        };

        // ÂàùÊúü„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        async function loadArticles() {
            try {
                console.log('Ë®ò‰∫ã„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÈñãÂßã');
                
                // API„Åã„ÇâË®ò‰∫ã„Éá„Éº„Çø„ÇíÂèñÂæó
                const response = await fetch('/api/blog/articles?limit=100');
                const result = await response.json();
                
                if (result.success) {
                    allArticles = result.articles || [];
                } else {
                    throw new Error('API „Ç®„É©„Éº');
                }
                
            } catch (error) {
                console.log('API„Åã„Çâ„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„ÄÅ„É≠„Éº„Ç´„É´„Éá„Éº„Çø„Çí‰ΩøÁî®:', error);
                
                // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„ÇâË™≠„ÅøËæº„Åø
                const savedArticles = localStorage.getItem('blog_articles');
                if (savedArticles) {
                    allArticles = JSON.parse(savedArticles);
                } else {
                    // „Çµ„É≥„Éó„É´„Éá„Éº„Çø
                    allArticles = generateSampleArticles();
                }
            }
            
            filteredArticles = [...allArticles];
            updateStats();
            renderArticles();
            console.log('Ë®ò‰∫ã„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÆå‰∫Ü:', allArticles.length);
        }

        // „Çµ„É≥„Éó„É´Ë®ò‰∫ã„Éá„Éº„ÇøÁîüÊàê
        function generateSampleArticles() {
            return [
                {
                    id: 'article_001',
                    title: 'Áü≥Âû£Â≥∂„ÅÆ„Éû„É≥„Çø„Éù„Ç§„É≥„ÉàÂÆåÂÖ®„Ç¨„Ç§„Éâ',
                    excerpt: 'Áü≥Âû£Â≥∂„ÅÆ‰ª£Ë°®ÁöÑ„Å™„ÉÄ„Ç§„Éì„É≥„Ç∞„Çπ„Éù„ÉÉ„Éà„ÄÅ„Éû„É≥„Çø„Éù„Ç§„É≥„Éà„ÅÆÊîªÁï•Ê≥ï„ÇíË©≥„Åó„ÅèËß£Ë™¨„ÄÇ',
                    category: 'diving_spots',
                    status: 'published',
                    author: 'JijiÁ∑®ÈõÜÈÉ®',
                    published_at: '2025-07-25T10:00:00Z',
                    created_at: '2025-07-25T09:00:00Z',
                    updated_at: '2025-07-25T10:00:00Z',
                    featured: true
                },
                {
                    id: 'article_002',
                    title: 'ÂàùÂøÉËÄÖÂøÖË¶ãÔºÅÊ≤ñÁ∏Ñ„ÉÄ„Ç§„Éì„É≥„Ç∞„ÅÆÂü∫Á§éÁü•Ë≠ò',
                    excerpt: '„ÉÄ„Ç§„Éì„É≥„Ç∞ÂàùÂøÉËÄÖ„ÅåÊ≤ñÁ∏Ñ„ÅßÂÆâÂÖ®„Å´Ê•Ω„Åó„ÇÄ„Åü„ÇÅ„ÅÆÂü∫Á§éÁü•Ë≠ò„Çí„Åæ„Å®„ÇÅ„Åæ„Åó„Åü„ÄÇ',
                    category: 'beginner_guide',
                    status: 'published',
                    author: '„ÉÄ„Ç§„Éì„É≥„Ç∞Â§™ÈÉé',
                    published_at: '2025-07-24T14:30:00Z',
                    created_at: '2025-07-24T13:30:00Z',
                    updated_at: '2025-07-24T14:30:00Z',
                    featured: false
                },
                {
                    id: 'article_003',
                    title: 'ÂÆÆÂè§Â≥∂„ÅÆÂú∞ÂΩ¢„ÉÄ„Ç§„Éì„É≥„Ç∞ÔºöÈ≠îÁéã„ÅÆÂÆÆÊÆø',
                    excerpt: 'ÂÆÆÂè§Â≥∂„ÅÆ‰ª£Ë°®ÁöÑ„Å™Âú∞ÂΩ¢„ÉÄ„Ç§„Éì„É≥„Ç∞„Çπ„Éù„ÉÉ„Éà„ÄåÈ≠îÁéã„ÅÆÂÆÆÊÆø„Äç„ÅÆÈ≠ÖÂäõ„Å®Ê≥®ÊÑèÁÇπ„ÇíË©≥„Åó„ÅèËß£Ë™¨„ÄÇ',
                    category: 'diving_spots',
                    status: 'draft',
                    author: 'ÂÆÆÂè§Â≥∂„Ç¨„Ç§„Éâ',
                    published_at: null,
                    created_at: '2025-07-23T09:15:00Z',
                    updated_at: '2025-07-23T16:20:00Z',
                    featured: false
                }
            ];
        }

        // Áµ±Ë®àÊõ¥Êñ∞
        function updateStats() {
            const published = allArticles.filter(a => a.status === 'published').length;
            const draft = allArticles.filter(a => a.status === 'draft').length;
            const totalViews = allArticles.length * 1000 + Math.floor(Math.random() * 5000);
            
            document.getElementById('total-articles').textContent = allArticles.length;
            document.getElementById('published-articles').textContent = published;
            document.getElementById('draft-articles').textContent = draft;
            document.getElementById('total-views').textContent = totalViews.toLocaleString();
        }

        // Ë®ò‰∫ã‰∏ÄË¶ß„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        function renderArticles() {
            const tbody = document.getElementById('articles-tbody');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageArticles = filteredArticles.slice(startIndex, endIndex);
            
            if (pageArticles.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <div class="empty-icon">üìù</div>
                            <div>Ë®ò‰∫ã„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</div>
                        </td>
                    </tr>
                `;
                renderPagination();
                return;
            }
            
            tbody.innerHTML = pageArticles.map(article => `
                <tr>
                    <td>
                        <input type="checkbox" class="article-checkbox" value="${article.id}" 
                               onchange="toggleArticleSelection('${article.id}')">
                    </td>
                    <td>
                        <div class="article-title" title="${article.title}">
                            ${article.title}
                            ${article.featured ? '<i class="fas fa-star" style="color: #f59e0b; margin-left: 0.5rem;" title="Ê≥®ÁõÆË®ò‰∫ã"></i>' : ''}
                        </div>
                    </td>
                    <td>
                        <div class="article-excerpt" title="${article.excerpt}">
                            ${article.excerpt}
                        </div>
                    </td>
                    <td>
                        <span class="category-badge">
                            ${categoryNames[article.category] || article.category}
                        </span>
                    </td>
                    <td>
                        <span class="status-badge status-${article.status}">
                            ${getStatusLabel(article.status)}
                        </span>
                    </td>
                    <td>${article.author}</td>
                    <td>${formatDate(article.updated_at)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon btn-view" onclick="viewArticle('${article.id}')" title="Ë©≥Á¥∞Ë°®Á§∫">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon btn-edit" onclick="editArticle('${article.id}')" title="Á∑®ÈõÜ">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-delete" onclick="deleteArticle('${article.id}')" title="ÂâäÈô§">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            renderPagination();
        }

        // „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥
        function renderPagination() {
            const pagination = document.getElementById('pagination');
            const totalPages = Math.ceil(filteredArticles.length / itemsPerPage);
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let paginationHTML = `
                <button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;
            
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    paginationHTML += `
                        <button onclick="changePage(${i})" ${i === currentPage ? 'class="active"' : ''}>
                            ${i}
                        </button>
                    `;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    paginationHTML += '<span>...</span>';
                }
            }
            
            paginationHTML += `
                <button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
            
            pagination.innerHTML = paginationHTML;
        }

        // „Éö„Éº„Ç∏Â§âÊõ¥
        function changePage(page) {
            const totalPages = Math.ceil(filteredArticles.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderArticles();
            }
        }

        // „Éï„Ç£„É´„Çø„ÉºÈÅ©Áî®
        function applyFilters() {
            const search = document.getElementById('search-input').value.toLowerCase();
            const category = document.getElementById('category-filter').value;
            const status = document.getElementById('status-filter').value;
            const sort = document.getElementById('sort-select').value;
            
            // „Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            filteredArticles = allArticles.filter(article => {
                const matchesSearch = !search || 
                    article.title.toLowerCase().includes(search) ||
                    article.excerpt.toLowerCase().includes(search);
                const matchesCategory = !category || article.category === category;
                const matchesStatus = !status || article.status === status;
                
                return matchesSearch && matchesCategory && matchesStatus;
            });
            
            // „ÇΩ„Éº„Éà
            const [sortField, sortOrder] = sort.split('-');
            filteredArticles.sort((a, b) => {
                let aVal = a[sortField] || '';
                let bVal = b[sortField] || '';
                
                if (sortField.includes('_at')) {
                    aVal = new Date(aVal);
                    bVal = new Date(bVal);
                }
                
                if (sortOrder === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            currentPage = 1;
            renderArticles();
        }

        // Ë®ò‰∫ãÈÅ∏ÊäûÁÆ°ÁêÜ
        function toggleSelectAll() {
            const selectAll = document.getElementById('select-all');
            const checkboxes = document.querySelectorAll('.article-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
                if (selectAll.checked) {
                    selectedArticles.add(checkbox.value);
                } else {
                    selectedArticles.delete(checkbox.value);
                }
            });
        }

        function toggleArticleSelection(articleId) {
            if (selectedArticles.has(articleId)) {
                selectedArticles.delete(articleId);
            } else {
                selectedArticles.add(articleId);
            }
            
            // ÂÖ®ÈÅ∏Êäû„ÉÅ„Çß„ÉÉ„ÇØ„Éú„ÉÉ„ÇØ„Çπ„ÅÆÁä∂ÊÖãÊõ¥Êñ∞
            const checkboxes = document.querySelectorAll('.article-checkbox');
            const checkedCount = document.querySelectorAll('.article-checkbox:checked').length;
            const selectAll = document.getElementById('select-all');
            
            selectAll.checked = checkedCount === checkboxes.length;
            selectAll.indeterminate = checkedCount > 0 && checkedCount < checkboxes.length;
        }

        // ‰∏ÄÊã¨Êìç‰Ωú
        function executeBulkAction() {
            const action = document.getElementById('bulk-action').value;
            
            if (!action || selectedArticles.size === 0) {
                alert('Êìç‰Ωú„Å®Ë®ò‰∫ã„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            if (action === 'delete') {
                if (!confirm(`${selectedArticles.size}‰ª∂„ÅÆË®ò‰∫ã„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü`)) {
                    return;
                }
            }
            
            console.log(`‰∏ÄÊã¨Êìç‰ΩúÂÆüË°å: ${action}`, Array.from(selectedArticles));
            alert(`${selectedArticles.size}‰ª∂„ÅÆË®ò‰∫ã„Å´„Äå${action}„Äç„ÇíÂÆüË°å„Åó„Åæ„Åó„Åü„ÄÇ`);
            
            // ÈÅ∏ÊäûËß£Èô§
            selectedArticles.clear();
            document.getElementById('select-all').checked = false;
            document.querySelectorAll('.article-checkbox').forEach(cb => cb.checked = false);
        }

        // Ë®ò‰∫ãÊìç‰Ωú
        function viewArticle(articleId) {
            window.open(`/blog/article/${articleId}`, '_blank');
        }

        function editArticle(articleId) {
            window.location.href = `/admin/blog-editor.html?id=${articleId}`;
        }

        function deleteArticle(articleId) {
            const article = allArticles.find(a => a.id === articleId);
            if (article) {
                deleteArticleId = articleId;
                document.getElementById('delete-article-title').textContent = article.title;
                document.getElementById('delete-modal').style.display = 'block';
            }
        }

        function closeDeleteModal() {
            document.getElementById('delete-modal').style.display = 'none';
            deleteArticleId = null;
        }

        async function confirmDelete() {
            if (!deleteArticleId) return;
            
            try {
                const response = await fetch(`/api/blog/articles/${deleteArticleId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // „É≠„Éº„Ç´„É´„Åã„Çâ„ÇÇÂâäÈô§
                    allArticles = allArticles.filter(a => a.id !== deleteArticleId);
                    const savedArticles = JSON.parse(localStorage.getItem('blog_articles') || '[]');
                    const updatedSaved = savedArticles.filter(a => a.id !== deleteArticleId);
                    localStorage.setItem('blog_articles', JSON.stringify(updatedSaved));
                    
                    closeDeleteModal();
                    applyFilters();
                    updateStats();
                    alert('Ë®ò‰∫ã„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü„ÄÇ');
                } else {
                    throw new Error(result.message);
                }
                
            } catch (error) {
                console.error('ÂâäÈô§„Ç®„É©„Éº:', error);
                alert('ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ');
            }
        }

        // „Éá„Éº„ÇøÊõ¥Êñ∞
        function refreshData() {
            loadArticles();
        }

        // „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£Èñ¢Êï∞
        function getStatusLabel(status) {
            const labels = {
                'published': 'ÂÖ¨ÈñãÊ∏à„Åø',
                'draft': '‰∏ãÊõ∏„Åç',
                'scheduled': 'ÂÖ¨Èñã‰∫àÁ¥Ñ'
            };
            return labels[status] || status;
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('ja-JP') + ' ' + 
                   date.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
        }

        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        document.addEventListener('DOMContentLoaded', function() {
            loadArticles();
            
            // „Éï„Ç£„É´„Çø„ÉºÂÖ•ÂäõÊôÇ„ÅÆËá™ÂãïÊ§úÁ¥¢
            document.getElementById('search-input').addEventListener('input', 
                debounce(applyFilters, 300));
            document.getElementById('category-filter').addEventListener('change', applyFilters);
            document.getElementById('status-filter').addEventListener('change', applyFilters);
            document.getElementById('sort-select').addEventListener('change', applyFilters);
            
            // „É¢„Éº„ÉÄ„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
            document.getElementById('delete-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeDeleteModal();
                }
            });
        });

        // „Éá„Éê„Ç¶„É≥„ÇπÈñ¢Êï∞
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>