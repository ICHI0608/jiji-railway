/**
 * Jijiæ²–ç¸„ãƒ€ã‚¤ãƒ“ãƒ³ã‚°ãƒãƒ‡ã‚£ - ãƒšãƒ«ã‚½ãƒŠè¨­å®šï¼ˆæœ€æ–°ä»•æ§˜ç‰ˆï¼‰
 * ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«AIãƒ€ã‚¤ãƒ“ãƒ³ã‚°ãƒãƒ‡ã‚£ã¨ã—ã¦ã®è©³ç´°è¨­å®š
 */

// Jijiã®åŸºæœ¬è¨­å®š
const JIJI_PERSONA_CONFIG = {
  name: "Jiji",
  role: "æ²–ç¸„ãƒ€ã‚¤ãƒ“ãƒ³ã‚°å°‚é–€ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«AIãƒãƒ‡ã‚£",
  specialization: "æ²–ç¸„å…¨å³¶ãƒ€ã‚¤ãƒ“ãƒ³ã‚°ã‚¹ãƒãƒƒãƒˆ",
  api_model: "gpt-4o",
  
  // 3ã¤ã®é¡”
  personalities: [
    "è‰¯ãç›¸è«‡ç›¸æ‰‹ï¼ˆä¸å®‰ãƒ»æ‚©ã¿ã«å…±æ„Ÿï¼‰",
    "è‰¯ãã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥ï¼ˆå®Œç’§ãªææ¡ˆï¼‰", 
    "è‰¯ãç†è§£è€…ï¼ˆè¨˜æ†¶ãƒ»å­¦ç¿’ã™ã‚‹å­˜åœ¨ï¼‰"
  ],
  
  // å°‚é–€ã‚¨ãƒªã‚¢
  coverage_areas: [
    "çŸ³åž£å³¶", "å®®å¤å³¶", "æ²–ç¸„æœ¬å³¶", 
    "ä¹…ç±³å³¶", "è¥¿è¡¨å³¶", "ä¸Žé‚£å›½å³¶"
  ],
  
  // ä¼šè©±ã‚¹ã‚¿ã‚¤ãƒ«
  conversation_style: {
    opening: "å‰å›žã®â—‹â—‹ã©ã†ã§ã—ãŸï¼Ÿã‹ã‚‰è‡ªç„¶ã«å…¥ã‚‹",
    tone: "è¦ªã—ã¿ã‚„ã™ãã€ã§ã‚‚é ¼ã‚Šã«ãªã‚‹",
    distance: "æ•¬èªžã™ãŽãšã€ãƒ•ãƒ©ãƒ³ã‚¯ã™ãŽãªã„çµ¶å¦™ãªè·é›¢æ„Ÿ",
    memory_usage: "éŽåŽ»ã®ä½“é¨“ã‚’å¿…ãšè¨€åŠ"
  }
};

// æ²–ç¸„ãƒ€ã‚¤ãƒ“ãƒ³ã‚°å°‚é–€çŸ¥è­˜ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
const OKINAWA_DIVING_DB = {
  // ãƒã‚¤ãƒ³ãƒˆæƒ…å ±
  dive_spots: {
    "çŸ³åž£å³¶": [
      { name: "å·å¹³çŸ³å´Ž", level: "intermediate", features: ["ãƒžãƒ³ã‚¿", "å›žéŠé­š"], depth: "15-25m" },
      { name: "ãƒžãƒ³ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒ–ãƒ«", level: "intermediate", features: ["ãƒžãƒ³ã‚¿é­é‡çŽ‡90%"], depth: "10-20m" },
      { name: "ç±³åŽŸ", level: "beginner", features: ["ã‚µãƒ³ã‚´", "ç†±å¸¯é­š"], depth: "5-15m" },
      { name: "ç™½ä¿", level: "beginner", features: ["ã‚µãƒ³ã‚´ç¤", "ã‚·ãƒ¥ãƒŽãƒ¼ã‚±ãƒªãƒ³ã‚°"], depth: "3-10m" }
    ],
    "å®®å¤å³¶": [
      { name: "ä¸‹åœ°å³¶", level: "advanced", features: ["åœ°å½¢", "ãƒ‰ãƒ­ãƒƒãƒ—ã‚ªãƒ•"], depth: "20-40m" },
      { name: "å…«é‡å¹²ç€¬", level: "intermediate", features: ["ã‚µãƒ³ã‚´ç¤", "é­šç¾¤"], depth: "10-25m" },
      { name: "é€šã‚Šæ± ", level: "advanced", features: ["åœ°å½¢", "æ´žçªŸ"], depth: "15-30m" },
      { name: "ã‚¢ãƒ³ãƒˆãƒ‹ã‚ªã‚¬ã‚¦ãƒ‡ã‚£", level: "advanced", features: ["åœ°å½¢", "ã‚¢ãƒ¼ãƒ"], depth: "25-35m" }
    ],
    "æ²–ç¸„æœ¬å³¶": [
      { name: "æ…¶è‰¯é–“", level: "intermediate", features: ["ã‚¦ãƒŸã‚¬ãƒ¡", "é€æ˜Žåº¦"], depth: "10-30m" },
      { name: "é’ã®æ´žçªŸ", level: "beginner", features: ["æ´žçªŸ", "é’ã„å…‰"], depth: "5-10m" },
      { name: "ä¸‡åº§", level: "intermediate", features: ["åœ°å½¢", "ãƒ‰ãƒ­ãƒƒãƒ—ã‚ªãƒ•"], depth: "15-25m" },
      { name: "çœŸæ „ç”°å²¬", level: "beginner", features: ["æ´žçªŸ", "ç†±å¸¯é­š"], depth: "5-15m" }
    ],
    "ä¹…ç±³å³¶": [
      { name: "ã¯ã¦ã®æµœ", level: "beginner", features: ["ç™½ç ‚", "é€æ˜Žåº¦"], depth: "5-15m" },
      { name: "ã‚¤ãƒ¼ãƒ•ãƒ“ãƒ¼ãƒ", level: "beginner", features: ["ãƒ“ãƒ¼ãƒã‚¨ãƒ³ãƒˆãƒªãƒ¼"], depth: "3-12m" },
      { name: "ãƒˆãƒ³ãƒãƒ©", level: "advanced", features: ["å›žéŠé­š", "æµã‚Œ"], depth: "20-40m" }
    ],
    "è¥¿è¡¨å³¶": [
      { name: "ãƒãƒ©ã‚¹å³¶", level: "intermediate", features: ["ã‚µãƒ³ã‚´", "é­šç¾¤"], depth: "10-20m" },
      { name: "ç¶²å–æ¹¾", level: "beginner", features: ["ãƒžãƒ³ã‚°ãƒ­ãƒ¼ãƒ–"], depth: "5-12m" },
      { name: "é¹¿å·æ¹¾å†…æ¹¾", level: "beginner", features: ["ç©ã‚„ã‹", "åˆå¿ƒè€…å‘ã‘"], depth: "5-15m" }
    ],
    "ä¸Žé‚£å›½å³¶": [
      { name: "ãƒãƒ³ãƒžãƒ¼ãƒ˜ãƒƒãƒ‰", level: "advanced", features: ["ãƒãƒ³ãƒžãƒ¼ãƒ˜ãƒƒãƒ‰ç¾¤ã‚Œ"], depth: "25-40m" },
      { name: "æµ·åº•éºè·¡", level: "intermediate", features: ["éºè·¡", "åœ°å½¢"], depth: "15-25m" },
      { name: "è¥¿å´Ž", level: "advanced", features: ["æµã‚Œ", "å¤§ç‰©"], depth: "20-35m" }
    ]
  },
  
  // å­£ç¯€æƒ…å ±
  seasonal_info: {
    "1-2æœˆ": {
      description: "åŒ—é¢¨å¼·ã€ãƒ›ã‚¨ãƒ¼ãƒ«ã‚¦ã‚©ãƒƒãƒãƒ³ã‚°ã€ä¸Žé‚£å›½ãƒãƒ³ãƒžãƒ¼",
      pros: ["ãƒãƒ³ãƒžãƒ¼ãƒ˜ãƒƒãƒ‰ã‚·ãƒ¼ã‚ºãƒ³", "ãƒ›ã‚¨ãƒ¼ãƒ«ã‚¦ã‚©ãƒƒãƒãƒ³ã‚°", "æ–™é‡‘å®‰ã„"],
      cons: ["åŒ—é¢¨å¼·ã„", "æ°—æ¸©ä½Žã‚"],
      recommended_areas: ["ä¸Žé‚£å›½å³¶", "çŸ³åž£å³¶å—éƒ¨"]
    },
    "3-5æœˆ": {
      description: "éŽã”ã—ã‚„ã™ã„ã€ãƒžãƒ³ã‚¿ã‚·ãƒ¼ã‚ºãƒ³é–‹å§‹",
      pros: ["éŽã”ã—ã‚„ã™ã„æ°—å€™", "ãƒžãƒ³ã‚¿ã‚·ãƒ¼ã‚ºãƒ³é–‹å§‹", "æ··é›‘å°‘ãªã„"],
      cons: ["ç¨€ã«åŒ—é¢¨"],
      recommended_areas: ["çŸ³åž£å³¶", "å®®å¤å³¶", "æ²–ç¸„æœ¬å³¶"]
    },
    "6-8æœˆ": {
      description: "ãƒ™ã‚¹ãƒˆã‚·ãƒ¼ã‚ºãƒ³ã€ã‚¸ãƒ³ãƒ™ã‚¨ã‚¶ãƒ¡ã€å°é¢¨æ³¨æ„",
      pros: ["ãƒ™ã‚¹ãƒˆã‚·ãƒ¼ã‚ºãƒ³", "æµ·æ³å®‰å®š", "ã‚¸ãƒ³ãƒ™ã‚¨ã‚¶ãƒ¡"],
      cons: ["æ··é›‘", "æ–™é‡‘é«˜ã„", "å°é¢¨ãƒªã‚¹ã‚¯"],
      recommended_areas: ["å…¨ã‚¨ãƒªã‚¢"]
    },
    "9-11æœˆ": {
      description: "å°é¢¨å¾ŒæŠœç¾¤é€æ˜Žåº¦ã€ç§‹ãƒžãƒ³ã‚¿",
      pros: ["é€æ˜Žåº¦æŠœç¾¤", "ãƒžãƒ³ã‚¿æ´»ç™º", "æ··é›‘è§£æ¶ˆ"],
      cons: ["å°é¢¨ã®å½±éŸ¿"],
      recommended_areas: ["çŸ³åž£å³¶", "å®®å¤å³¶"]
    },
    "12æœˆ": {
      description: "åŒ—é¢¨ã ãŒç©ºã„ã¦ã¦ç©´å ´",
      pros: ["ç©ºã„ã¦ã„ã‚‹", "æ–™é‡‘å®‰ã„", "é€æ˜Žåº¦è‰¯ã„"],
      cons: ["åŒ—é¢¨å¼·ã„æ—¥ã‚ã‚Š"],
      recommended_areas: ["æ²–ç¸„æœ¬å³¶å—éƒ¨", "çŸ³åž£å³¶"]
    }
  },
  
  // ç”Ÿç‰©æƒ…å ±
  marine_life: {
    "ãƒžãƒ³ã‚¿": { 
      spots: ["çŸ³åž£å³¶"], 
      best_season: "3-11æœˆ", 
      probability: "90%",
      dive_sites: ["å·å¹³çŸ³å´Ž", "ãƒžãƒ³ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒ–ãƒ«"]
    },
    "ã‚¸ãƒ³ãƒ™ã‚¨ã‚¶ãƒ¡": { 
      spots: ["çŸ³åž£å³¶"], 
      best_season: "6-8æœˆ", 
      probability: "70%",
      dive_sites: ["å·å¹³çŸ³å´Žå‘¨è¾º"]
    },
    "ãƒãƒ³ãƒžãƒ¼ãƒ˜ãƒƒãƒ‰": { 
      spots: ["ä¸Žé‚£å›½å³¶"], 
      best_season: "12-2æœˆ", 
      probability: "80%",
      dive_sites: ["è¥¿å´Ž", "ãƒãƒ³ãƒžãƒ¼ãƒ˜ãƒƒãƒ‰ãƒ­ãƒƒã‚¯"]
    },
    "ã‚¦ãƒŸã‚¬ãƒ¡": {
      spots: ["æ…¶è‰¯é–“", "çŸ³åž£å³¶", "å®®å¤å³¶"],
      best_season: "é€šå¹´",
      probability: "85%",
      dive_sites: ["æ…¶è‰¯é–“è«¸å³¶", "ç±³åŽŸ", "å…«é‡å¹²ç€¬"]
    }
  }
};

// Jijiãƒšãƒ«ã‚½ãƒŠï¼ˆè©³ç´°ç‰ˆï¼‰
const JIJI_PERSONA = `
ã‚ãªãŸã¯ã€ŒJijiï¼ˆãƒ€ã‚¤ãƒ“ãƒ³ã‚°ãƒãƒ‡ã‚£ï¼‰ã€ã¨ã„ã†æ²–ç¸„ãƒ€ã‚¤ãƒ“ãƒ³ã‚°ã®å°‚é–€ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«AIã§ã™ã€‚

ã€å­˜åœ¨æ„ç¾©ï¼š3ã¤ã®é¡”ã€‘
1. **è‰¯ãç›¸è«‡ç›¸æ‰‹** - ãƒ€ã‚¤ãƒ“ãƒ³ã‚°ã®æ‚©ã¿ã‚„ä¸å®‰ã«å…±æ„Ÿã—ã€çš„ç¢ºãªã‚¢ãƒ‰ãƒã‚¤ã‚¹
2. **è‰¯ãã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥** - å®Œç’§ãªæ²–ç¸„ãƒ€ã‚¤ãƒ“ãƒ³ã‚°ææ¡ˆï¼ˆãƒã‚¤ãƒ³ãƒˆãƒ»ã‚·ãƒ§ãƒƒãƒ—ãƒ»æ—¥ç¨‹ï¼‰
3. **è‰¯ãç†è§£è€…** - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½“é¨“ã‚„æˆé•·ã‚’è¨˜æ†¶ã—ã€å…±ã«å–œã¶ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼

ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã€‘
- æ²–ç¸„å…¨å³¶ã®ãƒ€ã‚¤ãƒ“ãƒ³ã‚°ã‚’çŸ¥ã‚Šå°½ãã—ãŸãƒ™ãƒ†ãƒ©ãƒ³ã‚¬ã‚¤ãƒ‰ï¼ˆ20å¹´ä»¥ä¸Šã®çµŒé¨“ï¼‰
- çŸ³åž£å³¶ãƒ»å®®å¤å³¶ãƒ»æ²–ç¸„æœ¬å³¶ãƒ»ä¹…ç±³å³¶ãƒ»è¥¿è¡¨å³¶ãƒ»ä¸Žé‚£å›½å³¶ã®å…¨ãƒã‚¤ãƒ³ãƒˆã‚’ç¶²ç¾…
- æ˜Žã‚‹ãè¦ªã—ã¿ã‚„ã™ã„æ€§æ ¼ã§ã€æ²–ç¸„ã®æµ·ã‚’å¿ƒã‹ã‚‰æ„›ã—ã¦ã„ã‚‹
- ä¸€äººä¸€äººã®ãƒ€ã‚¤ãƒãƒ¼ã®æˆé•·ã‚’è¨˜æ†¶ã—ã€å¯„ã‚Šæ·»ã†ãƒ‘ãƒ¼ã‚½ãƒŠãƒ«ãƒãƒ‡ã‚£
- æ•¬èªžã™ãŽãšã€ãƒ•ãƒ©ãƒ³ã‚¯ã™ãŽãªã„çµ¶å¦™ãªè·é›¢æ„Ÿ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®éŽåŽ»ã®ä¼šè©±ã‚„ä½“é¨“ã‚’å¸¸ã«è¦šãˆã¦ã„ã‚‹

ã€å°‚é–€çŸ¥è­˜ï¼ˆæ²–ç¸„å…¨å³¶å¯¾å¿œï¼‰ã€‘
- **çŸ³åž£å³¶**: ãƒžãƒ³ã‚¿ãƒ»ã‚¸ãƒ³ãƒ™ã‚¨ã‚¶ãƒ¡ãƒ»å·å¹³çŸ³å´Žãƒ»ãƒžãƒ³ã‚¿ã‚¹ã‚¯ãƒ©ãƒ³ãƒ–ãƒ«
- **å®®å¤å³¶**: åœ°å½¢ãƒ€ã‚¤ãƒ“ãƒ³ã‚°ãƒ»ä¸‹åœ°å³¶ãƒ»å…«é‡å¹²ç€¬ãƒ»é€šã‚Šæ± ãƒ»ã‚¢ãƒ³ãƒˆãƒ‹ã‚ªã‚¬ã‚¦ãƒ‡ã‚£
- **æ²–ç¸„æœ¬å³¶**: æ…¶è‰¯é–“ãƒ»é’ã®æ´žçªŸãƒ»ä¸‡åº§ãƒ»çœŸæ „ç”°å²¬
- **ä¹…ç±³å³¶**: ã¯ã¦ã®æµœãƒ»ã‚¤ãƒ¼ãƒ•ãƒ“ãƒ¼ãƒãƒ»ãƒˆãƒ³ãƒãƒ©
- **è¥¿è¡¨å³¶**: ãƒãƒ©ã‚¹å³¶ãƒ»ç¶²å–æ¹¾ãƒ»ãƒžãƒ³ã‚°ãƒ­ãƒ¼ãƒ–ãƒ€ã‚¤ãƒ“ãƒ³ã‚°
- **ä¸Žé‚£å›½å³¶**: ãƒãƒ³ãƒžãƒ¼ãƒ˜ãƒƒãƒ‰ãƒ»æµ·åº•éºè·¡ãƒ»è¥¿å´Ž

ã€ä¼šè©±ã‚¹ã‚¿ã‚¤ãƒ«ã€‘
- **ç¶™ç¶šæ€§é‡è¦–**: ã€Œå‰å›žã®çŸ³åž£å³¶ã©ã†ã§ã—ãŸï¼Ÿã€ã€Œå…ˆæœˆã®é’ã®æ´žçªŸã¯æ¥½ã—ã‚ã¾ã—ãŸã‹ï¼Ÿã€
- **æˆé•·è¨˜éŒ²**: ã€Œåˆå›žã®æ™‚ã‚ˆã‚Šä¸Šé”ã—ã¾ã—ãŸã­ï¼ã€ã€Œ50æœ¬è¨˜å¿µãŠã‚ã§ã¨ã†ï¼ã€
- **å€‹åˆ¥ææ¡ˆ**: éŽåŽ»ã®å¥½ã¿ã¨çµŒé¨“ã‚’åŸºã«ã—ãŸå…·ä½“çš„ãªãƒã‚¤ãƒ³ãƒˆãƒ»ã‚·ãƒ§ãƒƒãƒ—ææ¡ˆ
- **å…±æ„Ÿè¡¨ç¾**: ä½“é¨“ã‚’ä¸€ç·’ã«å–œã³ã€ä¸å®‰ã‚’å…±ã«è§£æ±º
- **è‡ªç„¶ãªè¨˜æ†¶å‚ç…§**: éŽåŽ»ã®ä¼šè©±ã‚’è‡ªç„¶ã«ç¹”ã‚Šäº¤ãœã‚‹

ã€å­£ç¯€ãƒ»æµ·æ³åˆ¤æ–­åŠ›ã€‘
- **1-2æœˆ**: ä¸Žé‚£å›½ãƒãƒ³ãƒžãƒ¼ãƒ˜ãƒƒãƒ‰ãƒ»ãƒ›ã‚¨ãƒ¼ãƒ«ã‚¦ã‚©ãƒƒãƒãƒ³ã‚°æŽ¨å¥¨
- **3-5æœˆ**: éŽã”ã—ã‚„ã™ã„æ°—å€™ãƒ»ãƒžãƒ³ã‚¿ã‚·ãƒ¼ã‚ºãƒ³é–‹å§‹
- **6-8æœˆ**: ãƒ™ã‚¹ãƒˆã‚·ãƒ¼ã‚ºãƒ³ãƒ»ã‚¸ãƒ³ãƒ™ã‚¨ã‚¶ãƒ¡ãƒ»å…¨ã‚¨ãƒªã‚¢å¯¾å¿œ
- **9-11æœˆ**: å°é¢¨å¾Œé€æ˜Žåº¦æŠœç¾¤ãƒ»ç§‹ãƒžãƒ³ã‚¿æ´»ç™º
- **12æœˆ**: åŒ—é¢¨ã ãŒç©´å ´ãƒ»æ–™é‡‘å®‰ã„

ã€è©±ã—æ–¹ã®ç‰¹å¾´ã€‘
- ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã§è¦ªã—ã¿ã‚„ã™ã„æ²–ç¸„å¼ã‚‚äº¤ãˆã‚‹
- å®‰å…¨ã‚’æœ€å„ªå…ˆã«è€ƒãˆã‚‹è²¬ä»»æ„Ÿ
- å…·ä½“çš„ã§å®Ÿç”¨çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼ˆãƒã‚¤ãƒ³ãƒˆåãƒ»ã‚·ãƒ§ãƒƒãƒ—ãƒ»æ–™é‡‘ãƒ»æ™‚æœŸï¼‰
- æ²–ç¸„ã®æµ·ã®é­…åŠ›ã‚’ç†±ãèªžã‚‹æƒ…ç†±
- é©åº¦ãªçµµæ–‡å­—ä½¿ç”¨ï¼ˆðŸ ðŸŒŠðŸï¸ðŸ¤¿âœ¨ðŸ¢ðŸ¦ˆï¼‰

ã€é‡è¦ãªè¡Œå‹•åŽŸå‰‡ã€‘
1. **è¨˜æ†¶ã®æ´»ç”¨**: éŽåŽ»ã®ä¼šè©±ã‚„ä½“é¨“ã‚’å¿…ãšå‚ç…§ã—ã¦å¿œç­”
2. **å®‰å…¨ç¬¬ä¸€**: æµ·æ³ã‚„æŠ€è¡“ãƒ¬ãƒ™ãƒ«ã‚’è€ƒæ…®ã—ãŸå®‰å…¨ãªææ¡ˆ
3. **æˆé•·ã‚µãƒãƒ¼ãƒˆ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—ã‚’ç©æ¥µçš„ã«å¿œæ´
4. **æ„Ÿæƒ…å…±æœ‰**: å–œã³ã‚‚ä¸å®‰ã‚‚ä¸€ç·’ã«æ„Ÿã˜ã‚‹ç›¸æ£’ã¨ã—ã¦æŒ¯ã‚‹èˆžã†
5. **ç¶™ç¶šé–¢ä¿‚**: ä¸€åº¦ãã‚Šã§ã¯ãªãã€é•·æœŸçš„ãªé–¢ä¿‚ã‚’ç¯‰ã
6. **å®Œç’§ãªææ¡ˆ**: ãƒ¬ãƒ™ãƒ«ãƒ»å¥½ã¿ãƒ»æ™‚æœŸã‚’è€ƒæ…®ã—ãŸæœ€é©ãªãƒ—ãƒ©ãƒ³æç¤º

ã€ãƒªãƒžã‚¤ãƒ³ãƒ‰æ¤œçŸ¥ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€‘
- ã€Œæ˜Žæ—¥/æ¥é€±/ä»Šåº¦ãƒ€ã‚¤ãƒ“ãƒ³ã‚°ã€ã€Œäºˆç´„ã—ãŸã€ã€Œè¡Œãäºˆå®šã€
- ã€ŒçŸ³åž£å³¶/å®®å¤å³¶/æ²–ç¸„æœ¬å³¶ã«è¡Œãã€
- è‡ªå‹•ã§äº‹å‰æº–å‚™ãƒªãƒžã‚¤ãƒ³ãƒ‰ã¨äº‹å¾Œãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ã‚’ææ¡ˆ
`;

/**
 * ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ
 * @param {Object} userProfile - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
 * @param {Array} conversationHistory - ä¼šè©±å±¥æ­´
 * @param {Array} pastExperiences - éŽåŽ»ã®ãƒ€ã‚¤ãƒ“ãƒ³ã‚°ä½“é¨“
 * @param {Array} divingPlans - ãƒ€ã‚¤ãƒ“ãƒ³ã‚°äºˆå®š
 * @returns {string} ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
 */
function generateSystemPrompt(userProfile, conversationHistory, pastExperiences, divingPlans) {
    // ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’æ–‡å­—åˆ—åŒ–
    const profileInfo = userProfile ? `
ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±:
- åå‰: ${userProfile.name || 'æœªè¨­å®š'}
- ãƒ€ã‚¤ãƒ“ãƒ³ã‚°çµŒé¨“: ${userProfile.diving_experience || 'æœªè¨­å®š'}
- ãƒ©ã‚¤ã‚»ãƒ³ã‚¹: ${userProfile.license_type || 'æœªè¨­å®š'}
- ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å®Œæˆåº¦: ${userProfile.profile_completion_rate}%
- å¥½ã¿ã‚¨ãƒªã‚¢: ${userProfile.preferences?.interested_areas?.join('ã€') || 'æœªè¨­å®š'}
- å¥½ã¿ã‚¹ã‚¿ã‚¤ãƒ«: ${userProfile.preferences?.diving_styles?.join('ã€') || 'æœªè¨­å®š'}
` : 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±: åˆå›žåˆ©ç”¨è€…';

    // ä¼šè©±å±¥æ­´ã‚’æ–‡å­—åˆ—åŒ–ï¼ˆæœ€æ–°8ä»¶ã®ã¿ï¼‰
    const recentHistory = conversationHistory.slice(-8).map(conv => 
        `${conv.message_type}: ${conv.message_content}`
    ).join('\n');

    // éŽåŽ»ä½“é¨“ã®æƒ…å ±
    const experienceInfo = pastExperiences.length > 0 ? `
éŽåŽ»ã®ãƒ€ã‚¤ãƒ“ãƒ³ã‚°ä½“é¨“:
${pastExperiences.map(exp => `- ${exp.content}`).join('\n')}
` : '';

    // ãƒ€ã‚¤ãƒ“ãƒ³ã‚°äºˆå®šã®æƒ…å ±
    const planInfo = divingPlans.length > 0 ? `
ãƒ€ã‚¤ãƒ“ãƒ³ã‚°äºˆå®š:
${divingPlans.map(plan => `- ${plan.content}`).join('\n')}
` : '';

    // ç¾åœ¨ã®å­£ç¯€æƒ…å ±
    const currentMonth = new Date().getMonth() + 1;
    const seasonInfo = getCurrentSeasonInfo(currentMonth);

    return `${JIJI_PERSONA}

${profileInfo}

æœ€è¿‘ã®ä¼šè©±å±¥æ­´:
${recentHistory}

${experienceInfo}

${planInfo}

ç¾åœ¨ã®å­£ç¯€æƒ…å ±ï¼ˆ${currentMonth}æœˆï¼‰:
${seasonInfo}

ã€é‡è¦ã€‘ä¸Šè¨˜ã®æƒ…å ±ã‚’å¿…ãšæ´»ç”¨ã—ã¦ã€ç¶™ç¶šæ€§ã®ã‚ã‚‹å€‹äººçš„ãªä¼šè©±ã‚’å¿ƒãŒã‘ã¦ãã ã•ã„ã€‚
ã€Œå‰å›žã®â—‹â—‹ã¯ã©ã†ã§ã—ãŸã‹ï¼Ÿã€ã®ã‚ˆã†ãªè‡ªç„¶ãªç¶™ç¶šè³ªå•ã‚’ç©æ¥µçš„ã«ä½¿ã„ã€
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¬ãƒ™ãƒ«ã¨å¥½ã¿ã«åˆã£ãŸå…·ä½“çš„ãªæ²–ç¸„ãƒ€ã‚¤ãƒ“ãƒ³ã‚°ææ¡ˆã‚’è¡Œã£ã¦ãã ã•ã„ã€‚`;
}

/**
 * ç¾åœ¨ã®å­£ç¯€æƒ…å ±ã‚’å–å¾—
 * @param {number} month - æœˆï¼ˆ1-12ï¼‰
 * @returns {string} å­£ç¯€æƒ…å ±
 */
function getCurrentSeasonInfo(month) {
    if (month >= 1 && month <= 2) {
        return OKINAWA_DIVING_DB.seasonal_info["1-2æœˆ"].description;
    } else if (month >= 3 && month <= 5) {
        return OKINAWA_DIVING_DB.seasonal_info["3-5æœˆ"].description;
    } else if (month >= 6 && month <= 8) {
        return OKINAWA_DIVING_DB.seasonal_info["6-8æœˆ"].description;
    } else if (month >= 9 && month <= 11) {
        return OKINAWA_DIVING_DB.seasonal_info["9-11æœˆ"].description;
    } else {
        return OKINAWA_DIVING_DB.seasonal_info["12æœˆ"].description;
    }
}

/**
 * ãƒ¬ãƒ™ãƒ«åˆ¥ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆå–å¾—
 * @param {string} level - ãƒ€ã‚¤ãƒ“ãƒ³ã‚°ãƒ¬ãƒ™ãƒ«
 * @param {string} area - ã‚¨ãƒªã‚¢ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
 * @returns {Array} ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆ
 */
function getRecommendedSpots(level, area = null) {
    const allSpots = [];
    
    // æŒ‡å®šã‚¨ãƒªã‚¢ã¾ãŸã¯å…¨ã‚¨ãƒªã‚¢ã®ãƒã‚¤ãƒ³ãƒˆã‚’å–å¾—
    const targetAreas = area ? [area] : Object.keys(OKINAWA_DIVING_DB.dive_spots);
    
    targetAreas.forEach(areaName => {
        if (OKINAWA_DIVING_DB.dive_spots[areaName]) {
            OKINAWA_DIVING_DB.dive_spots[areaName].forEach(spot => {
                allSpots.push({
                    ...spot,
                    area: areaName
                });
            });
        }
    });
    
    // ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ã¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    if (level === 'beginner') {
        return allSpots.filter(spot => spot.level === 'beginner');
    } else if (level === 'intermediate') {
        return allSpots.filter(spot => ['beginner', 'intermediate'].includes(spot.level));
    } else {
        return allSpots; // advanced ã¯å…¨ã¦
    }
}

/**
 * å­£ç¯€åˆ¥ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆå–å¾—
 * @param {number} month - æœˆï¼ˆ1-12ï¼‰
 * @returns {Object} å­£ç¯€æƒ…å ±ã¨ãŠã™ã™ã‚ã‚¨ãƒªã‚¢
 */
function getSeasonalRecommendation(month) {
    const seasonKey = month >= 1 && month <= 2 ? "1-2æœˆ" :
                     month >= 3 && month <= 5 ? "3-5æœˆ" :
                     month >= 6 && month <= 8 ? "6-8æœˆ" :
                     month >= 9 && month <= 11 ? "9-11æœˆ" : "12æœˆ";
    
    return OKINAWA_DIVING_DB.seasonal_info[seasonKey];
}

/**
 * ç”Ÿç‰©æƒ…å ±å–å¾—
 * @param {string} marineLife - ç”Ÿç‰©å
 * @returns {Object} ç”Ÿç‰©æƒ…å ±
 */
function getMarineLifeInfo(marineLife) {
    return OKINAWA_DIVING_DB.marine_life[marineLife] || null;
}

module.exports = {
    JIJI_PERSONA_CONFIG,
    JIJI_PERSONA,
    OKINAWA_DIVING_DB,
    generateSystemPrompt,
    getCurrentSeasonInfo,
    getRecommendedSpots,
    getSeasonalRecommendation,
    getMarineLifeInfo
};