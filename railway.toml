[build]
builder = "NIXPACKS"

[deploy]
startCommand = "npm start"
healthcheckPath = "/api/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[environments.production]
variables = { NODE_ENV = "production" }

# 非公開テスト環境用設定
[environments.staging]
variables = { NODE_ENV = "staging", SITE_STATUS = "private" }

# 将来の本番ドメイン設定（現在は非活性）
# [environments.production.domains]
# domains = ["dive-buddys.com", "www.dive-buddys.com"]

[environments.production.services.web]
# HTTPSリダイレクト強制
httpsOnly = true
# HSTS設定
headers = { "Strict-Transport-Security" = "max-age=31536000; includeSubDomains" }