<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª Dive Buddy's çµ±åˆãƒ†ã‚¹ãƒˆãƒ»å“è³ªä¿è¨¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .test-section {
            padding: 30px;
            border-bottom: 1px solid #eee;
        }

        .test-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 1.8rem;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #4CAF50;
            display: inline-block;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .test-card:hover {
            border-color: #4CAF50;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .test-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .test-button {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            width: 100%;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .test-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .test-result {
            min-height: 100px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
        }

        .success {
            color: #4CAF50;
            background-color: #f1f8e9;
            border-color: #4CAF50;
        }

        .error {
            color: #f44336;
            background-color: #ffebee;
            border-color: #f44336;
        }

        .warning {
            color: #ff9800;
            background-color: #fff3e0;
            border-color: #ff9800;
        }

        .info {
            color: #2196F3;
            background-color: #e3f2fd;
            border-color: #2196F3;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 1rem;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .test-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª çµ±åˆãƒ†ã‚¹ãƒˆãƒ»å“è³ªä¿è¨¼</h1>
            <p>Dive Buddy's ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</p>
        </div>

        <!-- ç·åˆçµ±è¨ˆ -->
        <div class="test-section">
            <h2 class="section-title">ğŸ“Š ãƒ†ã‚¹ãƒˆçµ±è¨ˆ</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-tests">0</div>
                    <div class="stat-label">ç·ãƒ†ã‚¹ãƒˆæ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="passed-tests">0</div>
                    <div class="stat-label">æˆåŠŸ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="failed-tests">0</div>
                    <div class="stat-label">å¤±æ•—</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="success-rate">0%</div>
                    <div class="stat-label">æˆåŠŸç‡</div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
        </div>

        <!-- åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2 class="section-title">ğŸ—ï¸ åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š</h3>
                    <div class="test-description">Supabaseæ¥ç¶šãƒ»ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œç¢ºèª</div>
                    <button class="test-button" onclick="testDatabaseConnection()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="db-connection-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
                <div class="test-card">
                    <h3>ğŸ” èªè¨¼ã‚·ã‚¹ãƒ†ãƒ </h3>
                    <div class="test-description">LINE Loginãƒ»ä¼šå“¡ç™»éŒ²ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†</div>
                    <button class="test-button" onclick="testAuthenticationSystem()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="auth-system-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
                <div class="test-card">
                    <h3>ğŸŒ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</h3>
                    <div class="test-description">å…¨API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ»ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°</div>
                    <button class="test-button" onclick="testAPIEndpoints()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="api-endpoints-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
            </div>
        </div>

        <!-- æ©Ÿèƒ½ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2 class="section-title">âš™ï¸ æ©Ÿèƒ½ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>ğŸª ã‚·ãƒ§ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ </h3>
                    <div class="test-description">æ¤œç´¢ãƒ»è©³ç´°ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ»B2Bç®¡ç†</div>
                    <button class="test-button" onclick="testShopSystem()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="shop-system-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
                <div class="test-card">
                    <h3>ğŸŒŠ æµ·æ³ãƒ»å¤©æ°—ã‚·ã‚¹ãƒ†ãƒ </h3>
                    <div class="test-description">æ°—è±¡åºAPIãƒ»ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æƒ…å ±è¡¨ç¤º</div>
                    <button class="test-button" onclick="testWeatherSystem()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="weather-system-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
                <div class="test-card">
                    <h3>âœˆï¸ æ—…è¡Œã‚µãƒãƒ¼ãƒˆ</h3>
                    <div class="test-description">èˆªç©ºåˆ¸ãƒ»å®¿æ³Šãƒ»è²»ç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</div>
                    <button class="test-button" onclick="testTravelSystem()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="travel-system-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
                <div class="test-card">
                    <h3>ğŸ“ ãƒ–ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ </h3>
                    <div class="test-description">è¨˜äº‹ç®¡ç†ãƒ»æ¤œç´¢ãƒ»é–¢é€£è¨˜äº‹ãƒ»SEO</div>
                    <button class="test-button" onclick="testBlogSystem()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="blog-system-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
                <div class="test-card">
                    <h3>ğŸ‘¤ ä¼šå“¡ã‚·ã‚¹ãƒ†ãƒ </h3>
                    <div class="test-description">ç™»éŒ²ãƒ»ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»ãƒã‚¤ãƒ³ãƒˆç®¡ç†</div>
                    <button class="test-button" onclick="testMemberSystem()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="member-system-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
                <div class="test-card">
                    <h3>ğŸ’¬ å£ã‚³ãƒŸã‚·ã‚¹ãƒ†ãƒ </h3>
                    <div class="test-description">æŠ•ç¨¿ãƒ»ç®¡ç†ãƒ»çµ±è¨ˆãƒ»æ‰¿èªãƒ•ãƒ­ãƒ¼</div>
                    <button class="test-button" onclick="testReviewSystem()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="review-system-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
            </div>
        </div>

        <!-- çµ±åˆãƒ»é€£æºãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2 class="section-title">ğŸ”— çµ±åˆãƒ»é€£æºãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>ğŸ¤– LINE Bot - Webé€£æº</h3>
                    <div class="test-description">èªè¨¼é€£æºãƒ»ãƒ‡ãƒ¼ã‚¿åŒæœŸãƒ»ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹é·ç§»</div>
                    <button class="test-button" onclick="testLINEWebIntegration()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="line-web-integration-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
                <div class="test-card">
                    <h3>ğŸ’³ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³</h3>
                    <div class="test-description">ãƒ—ãƒ©ãƒ³ç®¡ç†ãƒ»æ±ºæ¸ˆãƒ»åˆ¶é™ã‚·ã‚¹ãƒ†ãƒ </div>
                    <button class="test-button" onclick="testSubscriptionSystem()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="subscription-system-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
                <div class="test-card">
                    <h3>ğŸ“Š ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§</h3>
                    <div class="test-description">å±¥æ­´è¿½è·¡ãƒ»ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°ãƒ»æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯</div>
                    <button class="test-button" onclick="testDataIntegrity()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="data-integrity-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
            </div>
        </div>

        <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2 class="section-title">ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>âš¡ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿é€Ÿåº¦</h3>
                    <div class="test-description">å…¨ãƒšãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿æ™‚é–“æ¸¬å®š</div>
                    <button class="test-button" onclick="testPageLoadTimes()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="page-load-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
                <div class="test-card">
                    <h3>ğŸŒ API ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“</h3>
                    <div class="test-description">å…¨APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“</div>
                    <button class="test-button" onclick="testAPIResponseTimes()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="api-response-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
                <div class="test-card">
                    <h3>ğŸ’¾ ãƒ¡ãƒ¢ãƒªãƒ»ãƒªã‚½ãƒ¼ã‚¹</h3>
                    <div class="test-description">ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒ»ãƒªã‚½ãƒ¼ã‚¹åŠ¹ç‡æ€§</div>
                    <button class="test-button" onclick="testResourceUsage()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="resource-usage-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
            </div>
        </div>

        <!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <h2 class="section-title">ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>ğŸ›¡ï¸ èªè¨¼ãƒ»èªå¯</h3>
                    <div class="test-description">ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢ãƒ»æ¨©é™ç®¡ç†</div>
                    <button class="test-button" onclick="testSecurityAuth()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="security-auth-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
                <div class="test-card">
                    <h3>ğŸ” ãƒ‡ãƒ¼ã‚¿ä¿è­·</h3>
                    <div class="test-description">ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–ãƒ»æ©Ÿå¯†æƒ…å ±ä¿è­·</div>
                    <button class="test-button" onclick="testDataProtection()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="data-protection-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
                <div class="test-card">
                    <h3>ğŸŒ HTTPSãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼</h3>
                    <div class="test-description">SSLè¨¼æ˜æ›¸ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼</div>
                    <button class="test-button" onclick="testHTTPSSecurity()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <div class="test-result" id="https-security-result">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...</div>
                </div>
            </div>
        </div>

        <!-- å®Ÿè¡Œåˆ¶å¾¡ -->
        <div class="test-section">
            <h2 class="section-title">ğŸ® ãƒ†ã‚¹ãƒˆåˆ¶å¾¡</h2>
            <div style="text-align: center;">
                <button class="test-button" onclick="runAllTests()" style="width: 300px; margin: 10px;">ğŸš€ å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <button class="test-button" onclick="clearAllResults()" style="width: 300px; margin: 10px; background: #f44336;">ğŸ§¹ çµæœã‚¯ãƒªã‚¢</button>
                <button class="test-button" onclick="generateReport()" style="width: 300px; margin: 10px; background: #2196F3;">ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
            </div>
        </div>
    </div>

    <script>
        // ãƒ†ã‚¹ãƒˆçµ±è¨ˆ
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            running: 0
        };

        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function updateStats() {
            document.getElementById('total-tests').textContent = testStats.total;
            document.getElementById('passed-tests').textContent = testStats.passed;
            document.getElementById('failed-tests').textContent = testStats.failed;
            
            const successRate = testStats.total > 0 ? 
                Math.round((testStats.passed / testStats.total) * 100) : 0;
            document.getElementById('success-rate').textContent = successRate + '%';
            document.getElementById('progress-fill').style.width = successRate + '%';
        }

        function logResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.className = `test-result ${type}`;
            element.innerHTML = message;
        }

        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.className = 'test-result info';
            element.innerHTML = '<div class="loading"></div> ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...';
        }

        async function makeAPICall(url, options = {}) {
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                const data = await response.json();
                return { 
                    success: response.ok, 
                    data, 
                    status: response.status,
                    responseTime: performance.now()
                };
            } catch (error) {
                return { 
                    success: false, 
                    error: error.message,
                    responseTime: performance.now()
                };
            }
        }

        // åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
        async function testDatabaseConnection() {
            showLoading('db-connection-result');
            testStats.total++;
            testStats.running++;
            
            try {
                const startTime = performance.now();
                const result = await makeAPICall('/api/health');
                const responseTime = performance.now() - startTime;
                
                if (result.success) {
                    testStats.passed++;
                    logResult('db-connection-result', 
                        `âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæˆåŠŸ\\n` +
                        `â±ï¸ ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“: ${responseTime.toFixed(2)}ms\\n` +
                        `ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${result.data.database || 'OK'}\\n` +
                        `ğŸ”— Supabase: ${result.data.supabase_status || 'N/A'}`, 'success');
                } else {
                    testStats.failed++;
                    logResult('db-connection-result', 
                        `âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šå¤±æ•—\\n` +
                        `ğŸš¨ ã‚¨ãƒ©ãƒ¼: ${result.error}\\n` +
                        `ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${result.status}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                logResult('db-connection-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        async function testAuthenticationSystem() {
            showLoading('auth-system-result');
            testStats.total++;
            testStats.running++;
            
            try {
                const tests = [
                    { url: '/api/auth/status', name: 'èªè¨¼çŠ¶æ…‹ç¢ºèª' },
                    { url: '/api/line/auth/status', name: 'LINEèªè¨¼çŠ¶æ…‹' },
                    { url: '/api/members/session/status', name: 'ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†' }
                ];
                
                let results = [];
                for (const test of tests) {
                    const result = await makeAPICall(test.url);
                    results.push({
                        name: test.name,
                        success: result.success,
                        status: result.status
                    });
                }
                
                const successCount = results.filter(r => r.success).length;
                const isSuccess = successCount === tests.length;
                
                if (isSuccess) {
                    testStats.passed++;
                    logResult('auth-system-result', 
                        `âœ… èªè¨¼ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸\\n` +
                        `ğŸ“Š æˆåŠŸ: ${successCount}/${tests.length}\\n` +
                        results.map(r => `${r.success ? 'âœ…' : 'âŒ'} ${r.name}`).join('\\n'), 'success');
                } else {
                    testStats.failed++;
                    logResult('auth-system-result', 
                        `âš ï¸ èªè¨¼ã‚·ã‚¹ãƒ†ãƒ éƒ¨åˆ†çš„å•é¡Œ\\n` +
                        `ğŸ“Š æˆåŠŸ: ${successCount}/${tests.length}\\n` +
                        results.map(r => `${r.success ? 'âœ…' : 'âŒ'} ${r.name}`).join('\\n'), 'warning');
                }
            } catch (error) {
                testStats.failed++;
                logResult('auth-system-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        async function testAPIEndpoints() {
            showLoading('api-endpoints-result');
            testStats.total++;
            testStats.running++;
            
            try {
                const endpoints = [
                    '/api/shops/search',
                    '/api/weather/current',
                    '/api/travel/flights/search',
                    '/api/blog/articles',
                    '/api/members/profile',
                    '/api/reviews/list',
                    '/api/points/balance'
                ];
                
                let results = [];
                for (const endpoint of endpoints) {
                    const startTime = performance.now();
                    const result = await makeAPICall(endpoint);
                    const responseTime = performance.now() - startTime;
                    
                    results.push({
                        endpoint,
                        success: result.success,
                        responseTime: responseTime.toFixed(2),
                        status: result.status
                    });
                }
                
                const successCount = results.filter(r => r.success).length;
                const avgResponseTime = results.reduce((sum, r) => sum + parseFloat(r.responseTime), 0) / results.length;
                
                if (successCount >= endpoints.length * 0.8) {
                    testStats.passed++;
                    logResult('api-endpoints-result', 
                        `âœ… APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ­£å¸¸\\n` +
                        `ğŸ“Š æˆåŠŸ: ${successCount}/${endpoints.length}\\n` +
                        `â±ï¸ å¹³å‡ãƒ¬ã‚¹ãƒãƒ³ã‚¹: ${avgResponseTime.toFixed(2)}ms\\n` +
                        results.slice(0, 5).map(r => `${r.success ? 'âœ…' : 'âŒ'} ${r.endpoint} (${r.responseTime}ms)`).join('\\n'), 'success');
                } else {
                    testStats.failed++;
                    logResult('api-endpoints-result', 
                        `âš ï¸ API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå•é¡Œã‚ã‚Š\\n` +
                        `ğŸ“Š æˆåŠŸ: ${successCount}/${endpoints.length}\\n` +
                        `â±ï¸ å¹³å‡ãƒ¬ã‚¹ãƒãƒ³ã‚¹: ${avgResponseTime.toFixed(2)}ms\\n` +
                        results.slice(0, 5).map(r => `${r.success ? 'âœ…' : 'âŒ'} ${r.endpoint} (${r.responseTime}ms)`).join('\\n'), 'warning');
                }
            } catch (error) {
                testStats.failed++;
                logResult('api-endpoints-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        // æ©Ÿèƒ½ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
        async function testShopSystem() {
            showLoading('shop-system-result');
            testStats.total++;
            testStats.running++;
            
            try {
                const tests = [
                    { url: '/api/shops/search?location=æ²–ç¸„', name: 'ã‚·ãƒ§ãƒƒãƒ—æ¤œç´¢' },
                    { url: '/api/shops/details/shop_demo_1', name: 'ã‚·ãƒ§ãƒƒãƒ—è©³ç´°' },
                    { url: '/api/shops/filters', name: 'ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å–å¾—' },
                    { url: '/api/shop/dashboard/stats', name: 'B2Bç®¡ç†ç”»é¢' }
                ];
                
                let results = [];
                for (const test of tests) {
                    const result = await makeAPICall(test.url);
                    results.push({
                        name: test.name,
                        success: result.success
                    });
                }
                
                const successCount = results.filter(r => r.success).length;
                
                if (successCount >= 3) {
                    testStats.passed++;
                    logResult('shop-system-result', 
                        `âœ… ã‚·ãƒ§ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸\\n` +
                        `ğŸ“Š æˆåŠŸ: ${successCount}/${tests.length}\\n` +
                        results.map(r => `${r.success ? 'âœ…' : 'âŒ'} ${r.name}`).join('\\n'), 'success');
                } else {
                    testStats.failed++;
                    logResult('shop-system-result', 
                        `âš ï¸ ã‚·ãƒ§ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ å•é¡Œã‚ã‚Š\\n` +
                        `ğŸ“Š æˆåŠŸ: ${successCount}/${tests.length}\\n` +
                        results.map(r => `${r.success ? 'âœ…' : 'âŒ'} ${r.name}`).join('\\n'), 'warning');
                }
            } catch (error) {
                testStats.failed++;
                logResult('shop-system-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        async function testWeatherSystem() {
            showLoading('weather-system-result');
            testStats.total++;
            testStats.running++;
            
            try {
                const result = await makeAPICall('/api/weather/current?location=okinawa_main');
                
                if (result.success) {
                    testStats.passed++;
                    logResult('weather-system-result', 
                        `âœ… æµ·æ³ãƒ»å¤©æ°—ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸\\n` +
                        `ğŸŒŠ å¤©æ°—ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ\\n` +
                        `ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: æ°—è±¡åºAPI\\n` +
                        `â±ï¸ ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“: ${result.responseTime.toFixed(2)}ms`, 'success');
                } else {
                    testStats.failed++;
                    logResult('weather-system-result', 
                        `âŒ æµ·æ³ãƒ»å¤©æ°—ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼\\n` +
                        `ğŸš¨ ${result.error}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                logResult('weather-system-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        async function testTravelSystem() {
            showLoading('travel-system-result');
            testStats.total++;
            testStats.running++;
            
            try {
                const tests = [
                    { url: '/api/travel/flights/search?from=NRT&to=OKA', name: 'èˆªç©ºåˆ¸æ¤œç´¢' },
                    { url: '/api/travel/accommodations/search?location=æ²–ç¸„', name: 'å®¿æ³Šæ–½è¨­æ¤œç´¢' },
                    { url: '/api/travel/cost-calculator', name: 'è²»ç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼' }
                ];
                
                let results = [];
                for (const test of tests) {
                    const result = await makeAPICall(test.url);
                    results.push({
                        name: test.name,
                        success: result.success
                    });
                }
                
                const successCount = results.filter(r => r.success).length;
                
                if (successCount >= 2) {
                    testStats.passed++;
                    logResult('travel-system-result', 
                        `âœ… æ—…è¡Œã‚µãƒãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸\\n` +
                        `ğŸ“Š æˆåŠŸ: ${successCount}/${tests.length}\\n` +
                        results.map(r => `${r.success ? 'âœ…' : 'âŒ'} ${r.name}`).join('\\n'), 'success');
                } else {
                    testStats.failed++;
                    logResult('travel-system-result', 
                        `âš ï¸ æ—…è¡Œã‚µãƒãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ å•é¡Œã‚ã‚Š\\n` +
                        `ğŸ“Š æˆåŠŸ: ${successCount}/${tests.length}\\n` +
                        results.map(r => `${r.success ? 'âœ…' : 'âŒ'} ${r.name}`).join('\\n'), 'warning');
                }
            } catch (error) {
                testStats.failed++;
                logResult('travel-system-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        async function testBlogSystem() {
            showLoading('blog-system-result');
            testStats.total++;
            testStats.running++;
            
            try {
                const tests = [
                    { url: '/api/blog/articles', name: 'ãƒ–ãƒ­ã‚°è¨˜äº‹ä¸€è¦§' },
                    { url: '/api/blog/search?q=æ²–ç¸„', name: 'ãƒ–ãƒ­ã‚°æ¤œç´¢' },
                    { url: '/api/blog/articles/1/related', name: 'é–¢é€£è¨˜äº‹å–å¾—' }
                ];
                
                let results = [];
                for (const test of tests) {
                    const result = await makeAPICall(test.url);
                    results.push({
                        name: test.name,
                        success: result.success
                    });
                }
                
                const successCount = results.filter(r => r.success).length;
                
                if (successCount >= 2) {
                    testStats.passed++;
                    logResult('blog-system-result', 
                        `âœ… ãƒ–ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸\\n` +
                        `ğŸ“Š æˆåŠŸ: ${successCount}/${tests.length}\\n` +
                        results.map(r => `${r.success ? 'âœ…' : 'âŒ'} ${r.name}`).join('\\n'), 'success');
                } else {
                    testStats.failed++;
                    logResult('blog-system-result', 
                        `âš ï¸ ãƒ–ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ å•é¡Œã‚ã‚Š\\n` +
                        `ğŸ“Š æˆåŠŸ: ${successCount}/${tests.length}\\n` +
                        results.map(r => `${r.success ? 'âœ…' : 'âŒ'} ${r.name}`).join('\\n'), 'warning');
                }
            } catch (error) {
                testStats.failed++;
                logResult('blog-system-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        async function testMemberSystem() {
            showLoading('member-system-result');
            testStats.total++;
            testStats.running++;
            
            try {
                const result = await makeAPICall('/api/members/demo/profile');
                
                if (result.success) {
                    testStats.passed++;
                    logResult('member-system-result', 
                        `âœ… ä¼šå“¡ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸\\n` +
                        `ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—æˆåŠŸ\\n` +
                        `ğŸ¯ ãƒã‚¤ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ é€£æºOK`, 'success');
                } else {
                    testStats.failed++;
                    logResult('member-system-result', 
                        `âŒ ä¼šå“¡ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼\\n` +
                        `ğŸš¨ ${result.error}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                logResult('member-system-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        async function testReviewSystem() {
            showLoading('review-system-result');
            testStats.total++;
            testStats.running++;
            
            try {
                const result = await makeAPICall('/api/reviews/list?shop_id=shop_demo_1');
                
                if (result.success) {
                    testStats.passed++;
                    logResult('review-system-result', 
                        `âœ… å£ã‚³ãƒŸã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸\\n` +
                        `ğŸ“ å£ã‚³ãƒŸãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ\\n` +
                        `ğŸ“Š çµ±è¨ˆãƒ‡ãƒ¼ã‚¿å‡¦ç†OK`, 'success');
                } else {
                    testStats.failed++;
                    logResult('review-system-result', 
                        `âŒ å£ã‚³ãƒŸã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼\\n` +
                        `ğŸš¨ ${result.error}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                logResult('review-system-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        // çµ±åˆãƒ»é€£æºãƒ†ã‚¹ãƒˆ
        async function testLINEWebIntegration() {
            showLoading('line-web-integration-result');
            testStats.total++;
            testStats.running++;
            
            try {
                const result = await makeAPICall('/api/integration/status');
                
                if (result.success) {
                    testStats.passed++;
                    logResult('line-web-integration-result', 
                        `âœ… LINE-Webé€£æºæ­£å¸¸\\n` +
                        `ğŸ”— é€£æºçŠ¶æ…‹ç¢ºèªæˆåŠŸ\\n` +
                        `ğŸ”„ ãƒ‡ãƒ¼ã‚¿åŒæœŸæ©Ÿèƒ½OK`, 'success');
                } else {
                    testStats.failed++;
                    logResult('line-web-integration-result', 
                        `âŒ LINE-Webé€£æºã‚¨ãƒ©ãƒ¼\\n` +
                        `ğŸš¨ ${result.error}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                logResult('line-web-integration-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        async function testSubscriptionSystem() {
            showLoading('subscription-system-result');
            testStats.total++;
            testStats.running++;
            
            try {
                const result = await makeAPICall('/api/subscription/plans');
                
                if (result.success) {
                    testStats.passed++;
                    logResult('subscription-system-result', 
                        `âœ… ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸\\n` +
                        `ğŸ’³ ãƒ—ãƒ©ãƒ³æƒ…å ±å–å¾—æˆåŠŸ\\n` +
                        `ğŸ“Š èª²é‡‘ã‚·ã‚¹ãƒ†ãƒ é€£æºOK`, 'success');
                } else {
                    testStats.failed++;
                    logResult('subscription-system-result', 
                        `âŒ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼\\n` +
                        `ğŸš¨ ${result.error}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                logResult('subscription-system-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        async function testDataIntegrity() {
            showLoading('data-integrity-result');
            testStats.total++;
            testStats.running++;
            
            try {
                const result = await makeAPICall('/api/data-integrity/check/user_demo_1');
                
                if (result.success) {
                    testStats.passed++;
                    logResult('data-integrity-result', 
                        `âœ… ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸\\n` +
                        `ğŸ“Š æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯æˆåŠŸ\\n` +
                        `ğŸ”„ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°æ©Ÿèƒ½OK\\n` +
                        `ğŸ“ˆ å±¥æ­´è¿½è·¡ã‚·ã‚¹ãƒ†ãƒ OK`, 'success');
                } else {
                    testStats.failed++;
                    logResult('data-integrity-result', 
                        `âŒ ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼\\n` +
                        `ğŸš¨ ${result.error}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                logResult('data-integrity-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        async function testPageLoadTimes() {
            showLoading('page-load-result');
            testStats.total++;
            testStats.running++;
            
            try {
                const pages = [
                    '/',
                    '/shops-database',
                    '/travel-guide',
                    '/blog',
                    '/member'
                ];
                
                let totalTime = 0;
                let results = [];
                
                for (const page of pages) {
                    const startTime = performance.now();
                    try {
                        const response = await fetch(page);
                        const loadTime = performance.now() - startTime;
                        totalTime += loadTime;
                        results.push({ page, loadTime: loadTime.toFixed(2), success: response.ok });
                    } catch (error) {
                        results.push({ page, loadTime: 'Error', success: false });
                    }
                }
                
                const avgLoadTime = totalTime / pages.length;
                const successCount = results.filter(r => r.success).length;
                
                if (avgLoadTime < 2000 && successCount >= pages.length * 0.8) {
                    testStats.passed++;
                    logResult('page-load-result', 
                        `âœ… ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿é€Ÿåº¦è‰¯å¥½\\n` +
                        `â±ï¸ å¹³å‡èª­ã¿è¾¼ã¿æ™‚é–“: ${avgLoadTime.toFixed(2)}ms\\n` +
                        `ğŸ“Š æˆåŠŸãƒšãƒ¼ã‚¸: ${successCount}/${pages.length}\\n` +
                        results.slice(0, 3).map(r => `${r.page}: ${r.loadTime}ms`).join('\\n'), 'success');
                } else {
                    testStats.failed++;
                    logResult('page-load-result', 
                        `âš ï¸ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿é€Ÿåº¦è¦æ”¹å–„\\n` +
                        `â±ï¸ å¹³å‡èª­ã¿è¾¼ã¿æ™‚é–“: ${avgLoadTime.toFixed(2)}ms\\n` +
                        `ğŸ“Š æˆåŠŸãƒšãƒ¼ã‚¸: ${successCount}/${pages.length}`, 'warning');
                }
            } catch (error) {
                testStats.failed++;
                logResult('page-load-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        async function testAPIResponseTimes() {
            showLoading('api-response-result');
            testStats.total++;
            testStats.running++;
            
            try {
                const apis = [
                    '/api/shops/search',
                    '/api/weather/current',
                    '/api/blog/articles',
                    '/api/reviews/list'
                ];
                
                let totalTime = 0;
                let results = [];
                
                for (const api of apis) {
                    const startTime = performance.now();
                    const result = await makeAPICall(api);
                    const responseTime = performance.now() - startTime;
                    
                    totalTime += responseTime;
                    results.push({
                        api,
                        responseTime: responseTime.toFixed(2),
                        success: result.success
                    });
                }
                
                const avgResponseTime = totalTime / apis.length;
                const successCount = results.filter(r => r.success).length;
                
                if (avgResponseTime < 1000 && successCount >= apis.length * 0.8) {
                    testStats.passed++;
                    logResult('api-response-result', 
                        `âœ… API ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€Ÿåº¦è‰¯å¥½\\n` +
                        `â±ï¸ å¹³å‡ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“: ${avgResponseTime.toFixed(2)}ms\\n` +
                        `ğŸ“Š æˆåŠŸAPI: ${successCount}/${apis.length}\\n` +
                        results.map(r => `${r.api}: ${r.responseTime}ms`).join('\\n'), 'success');
                } else {
                    testStats.failed++;
                    logResult('api-response-result', 
                        `âš ï¸ API ãƒ¬ã‚¹ãƒãƒ³ã‚¹é€Ÿåº¦è¦æ”¹å–„\\n` +
                        `â±ï¸ å¹³å‡ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“: ${avgResponseTime.toFixed(2)}ms\\n` +
                        `ğŸ“Š æˆåŠŸAPI: ${successCount}/${apis.length}`, 'warning');
                }
            } catch (error) {
                testStats.failed++;
                logResult('api-response-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        async function testResourceUsage() {
            showLoading('resource-usage-result');
            testStats.total++;
            testStats.running++;
            
            try {
                // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡æ¸¬å®šï¼ˆæ¦‚ç®—ï¼‰
                const memoryInfo = performance.memory || {};
                const usedJSHeapSize = memoryInfo.usedJSHeapSize || 0;
                const totalJSHeapSize = memoryInfo.totalJSHeapSize || 0;
                
                // æ¥ç¶šæ•°ãƒ†ã‚¹ãƒˆ
                const concurrentTests = 5;
                const promises = [];
                
                for (let i = 0; i < concurrentTests; i++) {
                    promises.push(makeAPICall('/api/health'));
                }
                
                const results = await Promise.all(promises);
                const successCount = results.filter(r => r.success).length;
                
                testStats.passed++;
                logResult('resource-usage-result', 
                    `âœ… ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡æ­£å¸¸\\n` +
                    `ğŸ’¾ JSãƒ’ãƒ¼ãƒ—ä½¿ç”¨é‡: ${(usedJSHeapSize / 1024 / 1024).toFixed(2)}MB\\n` +
                    `ğŸ“Š åŒæ™‚æ¥ç¶šãƒ†ã‚¹ãƒˆ: ${successCount}/${concurrentTests}\\n` +
                    `ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: è‰¯å¥½`, 'success');
            } catch (error) {
                testStats.failed++;
                logResult('resource-usage-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ
        async function testSecurityAuth() {
            showLoading('security-auth-result');
            testStats.total++;
            testStats.running++;
            
            try {
                // èªè¨¼ãŒå¿…è¦ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ãƒ†ã‚¹ãƒˆ
                const protectedEndpoints = [
                    '/api/shop/dashboard/stats',
                    '/api/members/profile/edit',
                    '/api/admin/users'
                ];
                
                let results = [];
                for (const endpoint of protectedEndpoints) {
                    const result = await makeAPICall(endpoint);
                    // 401ã‚„403ãŒè¿”ã‚Œã°é©åˆ‡ã«ä¿è­·ã•ã‚Œã¦ã„ã‚‹
                    const isProtected = result.status === 401 || result.status === 403;
                    results.push({ endpoint, isProtected });
                }
                
                const protectedCount = results.filter(r => r.isProtected).length;
                
                if (protectedCount >= protectedEndpoints.length * 0.8) {
                    testStats.passed++;
                    logResult('security-auth-result', 
                        `âœ… èªè¨¼ãƒ»èªå¯ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸\\n` +
                        `ğŸ”’ ä¿è­·ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: ${protectedCount}/${protectedEndpoints.length}\\n` +
                        `ğŸ›¡ï¸ ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹é˜²æ­¢OK`, 'success');
                } else {
                    testStats.failed++;
                    logResult('security-auth-result', 
                        `âš ï¸ èªè¨¼ãƒ»èªå¯ã‚·ã‚¹ãƒ†ãƒ è¦ç¢ºèª\\n` +
                        `ğŸ”’ ä¿è­·ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: ${protectedCount}/${protectedEndpoints.length}`, 'warning');
                }
            } catch (error) {
                testStats.failed++;
                logResult('security-auth-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        async function testDataProtection() {
            showLoading('data-protection-result');
            testStats.total++;
            testStats.running++;
            
            try {
                // ãƒ‡ãƒ¼ã‚¿ä¿è­·ãƒ†ã‚¹ãƒˆï¼ˆæ©Ÿå¯†æƒ…å ±ã®æ¼æ´©ãƒã‚§ãƒƒã‚¯ï¼‰
                const result = await makeAPICall('/api/health');
                
                if (result.success) {
                    // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯
                    const responseText = JSON.stringify(result.data);
                    const sensitivePatterns = [
                        /password/i,
                        /secret/i,
                        /key.*[a-zA-Z0-9]{20,}/,
                        /token.*[a-zA-Z0-9]{20,}/
                    ];
                    
                    const foundSensitive = sensitivePatterns.some(pattern => 
                        pattern.test(responseText));
                    
                    if (!foundSensitive) {
                        testStats.passed++;
                        logResult('data-protection-result', 
                            `âœ… ãƒ‡ãƒ¼ã‚¿ä¿è­·ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸\\n` +
                            `ğŸ” æ©Ÿå¯†æƒ…å ±æ¼æ´©ãªã—\\n` +
                            `ğŸ“Š ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ç¢ºèª`, 'success');
                    } else {
                        testStats.failed++;
                        logResult('data-protection-result', 
                            `âš ï¸ ãƒ‡ãƒ¼ã‚¿ä¿è­·è¦ç¢ºèª\\n` +
                            `ğŸš¨ æ©Ÿå¯†æƒ…å ±ã®å¯èƒ½æ€§ã‚ã‚Š`, 'warning');
                    }
                } else {
                    testStats.failed++;
                    logResult('data-protection-result', 
                        `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¤±æ•—\\nğŸš¨ ${result.error}`, 'error');
                }
            } catch (error) {
                testStats.failed++;
                logResult('data-protection-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        async function testHTTPSSecurity() {
            showLoading('https-security-result');
            testStats.total++;
            testStats.running++;
            
            try {
                // HTTPSæ¥ç¶šã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒ†ã‚¹ãƒˆ
                const response = await fetch(window.location.origin + '/api/health');
                const headers = response.headers;
                
                const securityHeaders = [
                    'strict-transport-security',
                    'content-security-policy', 
                    'x-frame-options',
                    'x-content-type-options'
                ];
                
                let presentHeaders = [];
                securityHeaders.forEach(header => {
                    if (headers.get(header)) {
                        presentHeaders.push(header);
                    }
                });
                
                const isHTTPS = window.location.protocol === 'https:';
                const headerScore = presentHeaders.length / securityHeaders.length;
                
                if (isHTTPS && headerScore >= 0.75) {
                    testStats.passed++;
                    logResult('https-security-result', 
                        `âœ… HTTPSãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼æ­£å¸¸\\n` +
                        `ğŸ”’ HTTPSæ¥ç¶š: ${isHTTPS ? 'OK' : 'NG'}\\n` +
                        `ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼: ${presentHeaders.length}/${securityHeaders.length}\\n` +
                        `ğŸ“‹ è¨­å®šæ¸ˆã¿: ${presentHeaders.join(', ')}`, 'success');
                } else {
                    testStats.failed++;
                    logResult('https-security-result', 
                        `âš ï¸ HTTPSãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦æ”¹å–„\\n` +
                        `ğŸ”’ HTTPSæ¥ç¶š: ${isHTTPS ? 'OK' : 'NG'}\\n` +
                        `ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼: ${presentHeaders.length}/${securityHeaders.length}`, 'warning');
                }
            } catch (error) {
                testStats.failed++;
                logResult('https-security-result', 
                    `âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\\nğŸš¨ ${error.message}`, 'error');
            }
            
            testStats.running--;
            updateStats();
        }

        // åˆ¶å¾¡é–¢æ•°
        async function runAllTests() {
            // çµ±è¨ˆãƒªã‚»ãƒƒãƒˆ
            testStats = { total: 0, passed: 0, failed: 0, running: 0 };
            updateStats();
            
            // å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
            const testFunctions = [
                testDatabaseConnection,
                testAuthenticationSystem,
                testAPIEndpoints,
                testShopSystem,
                testWeatherSystem,
                testTravelSystem,
                testBlogSystem,
                testMemberSystem,
                testReviewSystem,
                testLINEWebIntegration,
                testSubscriptionSystem,
                testDataIntegrity,
                testPageLoadTimes,
                testAPIResponseTimes,
                testResourceUsage,
                testSecurityAuth,
                testDataProtection,
                testHTTPSSecurity
            ];
            
            // é †æ¬¡å®Ÿè¡Œï¼ˆä¸¦è¡Œã ã¨è² è·ãŒé«˜ã™ãã‚‹ï¼‰
            for (const testFunction of testFunctions) {
                await testFunction();
                // å°‘ã—é–“éš”ã‚’é–‹ã‘ã‚‹
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            // å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            setTimeout(() => {
                alert(`ğŸ‰ å…¨ãƒ†ã‚¹ãƒˆå®Œäº†ï¼\\næˆåŠŸ: ${testStats.passed}\\nå¤±æ•—: ${testStats.failed}\\næˆåŠŸç‡: ${Math.round((testStats.passed / testStats.total) * 100)}%`);
            }, 1000);
        }

        function clearAllResults() {
            const resultElements = document.querySelectorAll('.test-result');
            resultElements.forEach(element => {
                element.className = 'test-result';
                element.textContent = 'ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­...';
            });
            
            testStats = { total: 0, passed: 0, failed: 0, running: 0 };
            updateStats();
        }

        function generateReport() {
            const timestamp = new Date().toLocaleString('ja-JP');
            const successRate = testStats.total > 0 ? 
                Math.round((testStats.passed / testStats.total) * 100) : 0;
            
            const report = `
=== Dive Buddy's çµ±åˆãƒ†ã‚¹ãƒˆãƒ»å“è³ªä¿è¨¼ãƒ¬ãƒãƒ¼ãƒˆ ===
ç”Ÿæˆæ—¥æ™‚: ${timestamp}

ğŸ“Š ãƒ†ã‚¹ãƒˆçµ±è¨ˆ:
- ç·ãƒ†ã‚¹ãƒˆæ•°: ${testStats.total}
- æˆåŠŸ: ${testStats.passed}
- å¤±æ•—: ${testStats.failed}
- æˆåŠŸç‡: ${successRate}%

ğŸ¯ å“è³ªè©•ä¾¡:
${successRate >= 90 ? 'âœ… å„ªç§€ - æœ¬ç•ªç’°å¢ƒã¸ã®å±•é–‹æº–å‚™å®Œäº†' :
  successRate >= 80 ? 'âš ï¸ è‰¯å¥½ - è»½å¾®ãªæ”¹å–„å¾Œã«å±•é–‹å¯èƒ½' :
  successRate >= 70 ? 'âš ï¸ è¦æ”¹å–„ - å•é¡Œè§£æ±ºå¾Œã«å†ãƒ†ã‚¹ãƒˆæ¨å¥¨' :
  'âŒ è¦ä¿®æ­£ - é‡å¤§ãªå•é¡ŒãŒã‚ã‚Šã¾ã™'}

ğŸŒŠ Dive Buddy's ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å“è³ªä¿è¨¼å®Œäº†
            `;
            
            // ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `dive-buddys-test-report-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
        });
    </script>
</body>
</html>