# 🌊 Jiji Phase 5運用マニュアル
**【24/7運用監視・Google Sheets API統合・β-testing体制】**

## 📋 このマニュアルについて

**目的**: Phase 5本格運用における24/7監視体制・システム運用・ユーザーサポート手順
**対象**: 運用管理者・エンジニア・サポート担当者
**前提**: Phase 4-D完了・完全監視システム稼働中
**更新日**: 2025年7月10日

---

## 🚀 Phase 5運用開始チェックリスト

### ✅ **必須事前確認項目**

#### **システム稼働状況**
```
□ Railway本番環境正常稼働確認
□ LINE Bot応答確認（Channel ID: 2007331165）
□ Web App表示確認（https://jiji-bot-production.up.railway.app）
□ 監視エンドポイント正常応答確認（/api/monitoring）
□ 全APIエンドポイント疎通確認
□ データベース接続状況確認（Supabase/Mock）
```

#### **監視システム動作確認**
```
□ /api/monitoring - システム状況監視
□ /api/health - ヘルスチェック監視
□ /api/stats - 統計情報監視
□ エラーログ出力確認
□ パフォーマンス指標取得確認
□ アラート生成機能確認
```

---

## 📊 24/7監視運用体制

### 🔍 **リアルタイム監視項目**

#### **システム性能監視**
```
監視項目                 正常範囲              警告閾値              緊急閾値
─────────────────────────────────────────────────────────────────
応答時間                 0-3秒                3-5秒                5秒超過
エラー率                 0-2%                 2-5%                 5%超過
メモリ使用量             0-256MB              256-512MB            512MB超過
稼働率                   99.5%以上            99-99.5%             99%未満
同時接続数               0-50                 50-100               100超過
```

#### **機能監視項目**
```
監視対象                 確認間隔              対応要求レベル
────────────────────────────────────────────────────────
LINE Bot応答             5分毎                高：15分以内対応
感情分析API              10分毎               高：30分以内対応
店舗マッチング           10分毎               中：1時間以内対応
Web App表示             15分毎               中：1時間以内対応
データベース接続         5分毎                緊急：即座対応
```

### 📱 **監視実行方法**

#### **自動監視コマンド**
```bash
# システム状況確認
curl https://jiji-bot-production.up.railway.app/api/monitoring

# ヘルスチェック
curl https://jiji-bot-production.up.railway.app/api/health

# 統計情報確認
curl https://jiji-bot-production.up.railway.app/api/stats

# LINE Bot疎通確認
# LINE公式アカウント（@2007331165）に「テスト」送信
```

#### **手動確認項目**
```
□ Webアプリ表示確認（ブラウザ）
□ 感情分析機能テスト（「不安です」入力）
□ 店舗検索機能テスト（石垣島・宮古島検索）
□ LINE Bot対話テスト（基本的な質問）
□ エラーログ確認（Railway Management画面）
```

---

## ⚠️ アラート対応手順

### 🚨 **緊急事態対応（5秒以内対応開始）**

#### **システム完全停止**
```
症状: 全エンドポイント応答なし・Webアプリアクセス不可

即座実行:
1. Railway Management画面確認
2. 再デプロイ実行（緊急時）
3. システム復旧確認
4. ユーザーへの状況報告準備

報告先: 
- 運用管理者（即座連絡）
- ユーザー向けSNS告知準備
```

#### **高エラー率（5%超過）**
```
症状: /api/monitoring でエラー率5%超過警告

対応手順:
1. 最新エラーログ確認（直近10件）
2. エラー原因特定（API・DB・外部サービス）
3. 根本原因解決実行
4. 30分以内に正常化確認

エスカレーション:
- 30分で解決しない場合は管理者連絡
```

### ⚡ **警告レベル対応（30分以内対応開始）**

#### **応答時間遅延（3-5秒）**
```
対応手順:
1. /api/monitoring で詳細パフォーマンス確認
2. メモリ使用量・CPU負荷確認
3. 外部API（OpenAI・Supabase）応答時間確認
4. 必要に応じてキャッシュクリア・再起動

予防策:
- 定期的なパフォーマンス最適化
- ユーザー数増加に応じたスケーリング計画
```

#### **メモリ使用量増加（256-512MB）**
```
対応手順:
1. メモリリーク原因調査
2. 不要なセッション・キャッシュクリア
3. アプリケーション再起動検討
4. 継続監視強化（10分間隔）

長期対策:
- メモリ最適化・ガベージコレクション改善
- Railway環境スケールアップ検討
```

---

## 🔄 Google Sheets API統合準備

### 📊 **Phase 5データベース移行計画**

#### **現在のデータソース**
```
優先順位1: Supabase PostgreSQL（本番推奨）
優先順位2: Mock JSON データ（開発・フォールバック）
Phase 5目標: Google Sheets API統合（リアルタイム更新）
```

#### **Google Sheets API準備項目**
```
必要な準備:
□ Google Cloud Project作成
□ Google Sheets API有効化
□ サービスアカウント作成・認証情報取得
□ 79店舗データシート準備・フォーマット統一
□ API接続テスト・データ同期確認
□ フォールバック機能実装（Supabase→Sheets）
```

#### **データ移行手順**
```
Step 1: Google Sheets準備（1時間）
- 79店舗×34項目完全データ移行
- Jiji認定グレード（S/A/B/C）設定
- リアルタイム更新権限設定

Step 2: API統合実装（2時間）
- Google Sheets connector実装
- 既存Supabase connectorとの共通化
- エラーハンドリング・フォールバック実装

Step 3: テスト・切り替え（1時間）
- 全機能動作確認
- パフォーマンステスト
- 本番環境切り替え・監視強化
```

---

## 🧪 β-testing運用体制

### 👥 **ユーザーテスト計画**

#### **テストユーザー募集**
```
対象者:
- 初心者ダイバー（1-10回経験）
- 沖縄ダイビング検討中
- SNS活用・フィードバック提供可能

募集方法:
- Twitter・Instagram告知
- ダイビング関連コミュニティ
- 友人・知人ネットワーク
- ダイビングショップ協力
```

#### **テスト項目・評価基準**
```
基本機能テスト:
□ LINE Bot初回接触・応答品質
□ 感情分析精度・共感度
□ 店舗マッチング精度・満足度
□ Web App使いやすさ・デザイン
□ 全体ユーザー体験・継続利用意向

評価指標:
- 感情分析精度: 85%以上目標
- マッチング満足度: 4.0/5.0以上
- 継続利用意向: 70%以上
- 推薦意向（NPS）: 50以上
```

### 📝 **フィードバック収集・分析**

#### **フィードバック収集方法**
```
自動収集:
- /api/feedback エンドポイント経由
- Web App内フィードバックフォーム
- LINE Bot内評価ボタン

手動収集:
- ユーザーインタビュー（30分）
- SNSコメント・メンション監視
- メール・問い合わせ対応
```

#### **改善アクション**
```
週次改善サイクル:
1. フィードバック収集・整理
2. 優先度付け・改善計画策定
3. 実装・テスト・デプロイ
4. 効果測定・次週計画

重要改善項目:
- 感情分析精度向上
- 応答時間短縮
- UI/UX改善
- Jijiキャラクター親近感向上
```

---

## 📈 運用パフォーマンス目標

### 🎯 **Phase 5成功指標（KPI）**

#### **技術指標**
```
指標                     目標値                現在値
─────────────────────────────────────────────
システム稼働率           99.9%                 99.5%
平均応答時間             3秒以内               2秒以内
エラー率                 1%未満               0.5%
同時接続対応             100ユーザー           50ユーザー
メモリ効率               256MB以内             128MB
```

#### **ユーザー体験指標**
```
指標                     目標値                測定方法
──────────────────────────────────────────────
ユーザー満足度           4.5/5.0以上          フィードバック調査
感情分析精度             90%以上              専門家評価
マッチング精度           88%以上              ユーザー評価
継続利用率               75%以上              利用統計分析
推薦意向（NPS）          60以上               NPS調査
```

#### **ビジネス指標**
```
指標                     目標値                期間
─────────────────────────────────────────
月間アクティブユーザー   1,000人              3ヶ月
店舗紹介件数             500件/月             6ヶ月
収益化開始               手数料モデル開始      12ヶ月
```

---

## 🔧 運用ツール・環境

### 💻 **必要アクセス権限**

#### **Railway管理画面**
```
URL: https://railway.app/dashboard
権限: Jiji Bot Production環境管理
用途: デプロイ・ログ確認・環境変数管理
```

#### **LINE Developers Console**
```
URL: https://developers.line.biz/console/
権限: Channel 2007331165管理
用途: Webhook設定・メッセージ配信統計
```

#### **Supabase管理画面**
```
URL: https://supabase.com/dashboard
権限: Jijiデータベース管理
用途: データ管理・クエリ実行・バックアップ
```

### 📞 **緊急連絡体制**

#### **エスカレーション手順**
```
レベル1: 自動復旧・基本対応（30分）
レベル2: 運用担当者対応（1時間）
レベル3: 開発者・管理者対応（即座）

連絡手段:
- システム監視アラート
- メール通知
- 緊急時電話連絡
```

---

## 📅 運用スケジュール

### 📊 **定期作業**

#### **日次作業**
```
毎日実行:
□ システム稼働状況確認（朝・夜）
□ エラーログレビュー
□ ユーザーフィードバック確認
□ パフォーマンス指標チェック
```

#### **週次作業**
```
毎週実行:
□ 詳細パフォーマンス分析
□ ユーザー統計分析
□ 改善計画策定・実装
□ バックアップ・セキュリティ確認
```

#### **月次作業**
```
毎月実行:
□ 総合運用レポート作成
□ KPI達成状況評価
□ 次月改善計画策定
□ インフラ・セキュリティ見直し
```

---

**🌊 Jiji Phase 5運用マニュアルは、24/7安定稼働・ユーザー満足度最大化・継続的改善を実現するための実践的ガイドとして、運用成功を支援します。✨**