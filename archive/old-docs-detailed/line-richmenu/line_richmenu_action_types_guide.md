# 📱 LINE公式アカウント リッチメニュー「タイプ」設定完全ガイド

## 🎯 スクリーンショット分析結果

スクリーンショットから確認できる項目：
- **エリアC**（アンケートボタン）の設定画面
- **タイプ**ドロップダウンで「テキスト」が選択されている
- **テキスト入力欄**でメッセージを設定する必要がある

## 🔧 タイプ設定の選択肢

### **LINE公式アカウントで選択可能な5つのタイプ**

#### **1. テキスト（推奨・アンケート用）**
- **用途**: ユーザーがボタンをタップするとテキストメッセージを送信
- **仕組み**: 設定したテキストがトークに投稿され、Bot側で応答処理
- **アンケート設定**: ✅ **これを選択**

#### **2. リンク**
- **用途**: 外部URLへの遷移
- **例**: ウェブサイト、予約ページ、フォームなど
- **アンケート設定**: ❌ 不適切

#### **3. クーポン**
- **用途**: LINE公式アカウントで作成したクーポンの表示
- **アンケート設定**: ❌ 不適切

#### **4. ショップカード**
- **用途**: ポイントカード機能
- **アンケート設定**: ❌ 不適切

#### **5. 設定しない**
- **用途**: ボタンを無効化
- **アンケート設定**: ❌ 不適切

---

## ✅ アンケートボタンの正しい設定

### **エリアC（アンケート）の設定内容**

#### **Step 1: タイプ選択**
- **選択**: `テキスト` ✅

#### **Step 2: テキスト入力**
- **入力内容**: `アンケート開始`
- **重要**: この文字列はBot側のコードと完全一致させる必要があります

#### **Step 3: アクションラベル（オプション）**
- **入力内容**: `ダイビングアンケート開始`
- **用途**: 音声読み上げ機能用（最大100文字）

---

## 🎨 全6エリアの完全設定表

| エリア | 位置 | タイプ | テキスト | 目的 |
|--------|------|--------|----------|------|
| **A** | 左上 | テキスト | `体験相談` | 体験ダイビング相談 |
| **B** | 中上 | テキスト | `ショップDB` | ショップ検索 |
| **C** | 右上 | テキスト | `アンケート開始` | **アンケート機能** |
| **D** | 左下 | テキスト | `旅行計画` | 旅行計画サポート |
| **E** | 中下 | テキスト | `海況情報` | 海況・天気情報 |
| **F** | 右下 | テキスト | `ヘルプ` | 使い方ガイド |

---

## 🔄 テキストアクションの動作フロー

### **ユーザー操作からBot応答まで**

```
1. ユーザーが「アンケート」ボタンをタップ
   ↓
2. LINE側で「アンケート開始」テキストを送信
   ↓
3. message-handler.jsが「アンケート開始」を検知
   ↓
4. surveyManager.startSurvey()を実行
   ↓
5. アンケート質問＋QuickReplyボタンを返信
```

### **Bot側での処理コード（既実装済み）**

```javascript
// message-handler.jsでの処理
if (messageText === 'アンケート開始') {
    const isNewUser = !(await getUserProfile(userId));
    const surveyResponse = await surveyManager.startSurvey(userId, isNewUser);
    return formatResponseMessage(surveyResponse);
}
```

---

## ⚠️ 重要な注意事項

### **文字列の完全一致が必須**

#### **✅ 正しい設定**
- リッチメニュー設定: `アンケート開始`
- Bot側コード: `messageText === 'アンケート開始'`
- 結果: ✅ 正常動作

#### **❌ 間違った設定例**
- リッチメニュー設定: `アンケート開始 `（末尾スペース）
- リッチメニュー設定: `アンケート`（省略）
- リッチメニュー設定: `アンケート開始！`（記号追加）
- 結果: ❌ Bot応答しない

### **文字数制限**
- **テキスト**: 最大50文字
- **アクションラベル**: 最大100文字

---

## 🛠️ 実際の設定手順

### **スクリーンショットの画面での操作**

#### **Step 1: タイプ選択**
1. 「タイプ」ドロップダウンをクリック
2. **「テキスト」** を選択

#### **Step 2: テキスト入力**
1. 「テキストを入力」欄をクリック
2. **「アンケート開始」** を正確に入力
3. スペースや記号がないことを確認

#### **Step 3: 保存**
1. 設定内容を確認
2. 「保存」または「OK」をクリック

---

## 🧪 設定後のテスト方法

### **動作確認手順**

1. **リッチメニュー公開**
   - 全設定完了後に「公開」

2. **スマートフォンでテスト**
   - LINE公式アカウントを友だち追加
   - アンケートボタンをタップ

3. **期待される応答**
   ```
   👆 アンケートボタンタップ
   ↓
   🌺 はいさい！Jijiだよ！
   沖縄ダイビングの専属バディとして...
   まずは簡単なアンケート（3問30秒）で...
   ↓
   🏝️ ダイビング経験はどのくらい？
   [QuickReplyボタン表示]
   ```

4. **問題発生時の確認**
   - Bot側ログ確認
   - テキスト設定の再確認
   - 文字列の完全一致確認

---

## 📝 その他のエリア設定推奨値

### **基本応答メッセージ（参考）**

各エリア用のテキスト設定後、Bot側で以下のような応答を実装：

```javascript
switch(messageText) {
    case '体験相談':
        return '🤿 体験ダイビングのご相談ですね！初心者の方でも安心して楽しめる...';
    case 'ショップDB':
        return '🏪 沖縄のダイビングショップ検索機能です。エリア・スタイル・レベル別に...';
    case '旅行計画':
        return '🗓️ 沖縄ダイビング旅行の計画をサポートします！日程・予算・宿泊先...';
    case '海況情報':
        return '🌊 現在の海況・天気情報をお知らせします。本日の各エリアの状況...';
    case 'ヘルプ':
        return '❓ Dive Buddy\'s の使い方をご案内します。各機能の詳細...';
}
```

---

## 🎯 まとめ

### **アンケートボタン設定の答え**

**タイプ**: `テキスト`  
**テキスト**: `アンケート開始`

この設定により、ユーザーがアンケートボタンをタップすると、Bot側でアンケートシステムが起動し、QuickReplyボタン付きの質問が表示されます。

設定完了後、すぐにアンケート機能が利用可能になります！